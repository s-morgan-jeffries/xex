<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PlotEye</title>
  <meta name="keywords" content="PlotEye">
  <meta name="description" content="This function plots eye position traces">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html XeX --><!-- ../menu.html UtilityFunctions --><!-- menu.html assorted -->
<h1>PlotEye
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This function plots eye position traces</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function PlotEye(Trials,Indices,PlotAxis) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">    This function plots eye position traces
    Probably called from the trial viewer
    PlotEye(Trials,Indices,PlotAxis)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="inbetween.html" class="code" title="function y=inbetween(x,a,b,li,gi)">inbetween</a>	a simple function to do interval checking</li><li><a href="../../../XeX/UtilityFunctions/handlingGraphics/PlotCodes.html" class="code" title="function PlotCodes(Trial)">PlotCodes</a>	Function used in Trial Viewer to plot time of relevant codes</li><li><a href="../../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>	The main XeX saccade parser</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../XeX/SubGUIs/TrialViewer.html" class="code" title="function varargout = TrialViewer(varargin)">TrialViewer</a>	TRIALVIEWER M-file for TrialViewer.fig</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function PlotEye(Trials,Indices,PlotAxis)</a>
0002 
0003 <span class="comment">%    This function plots eye position traces</span>
0004 <span class="comment">%    Probably called from the trial viewer</span>
0005 <span class="comment">%    PlotEye(Trials,Indices,PlotAxis)</span>
0006 
0007 <span class="comment">%Initializing Variables</span>
0008 
0009 TrialIndex=Indices;
0010 
0011 <span class="keyword">for</span> TrialIndex=Indices
0012     
0013     CurrentEvents=Trials(TrialIndex).Events;
0014     CurrentCodes=double([CurrentEvents.Code]);
0015     CurrentTimes=double([CurrentEvents.Time]);
0016         CodeIndices=1:length(CurrentCodes);
0017 
0018     is_reward=find(CurrentCodes==1012);
0019     is_error=find(CurrentCodes==1013);
0020     is_fp=find(CurrentCodes==1003);
0021     is_rf=find(CurrentCodes==1007);
0022     is_rfoff=find(CurrentCodes==1010);
0023     is_photobad=find(CurrentCodes==1092);
0024     is_abort=find(CurrentCodes==1090);
0025     is_fixationbreak=find(CurrentCodes==1091);
0026     is_gap=find(CurrentCodes==1004);
0027     is_rf2=find(CurrentCodes==1047);
0028     
0029     FPx=nan; FPy=nan; RFx=nan; RFy=nan; RF2x=nan; RF2y=nan; 
0030     RFOnTime=nan; RF2OnTime=nan;
0031     FPOnTime=nan;RewardTime=nan; ErrorTime=nan;
0032     
0033     SaccadeOptions=getappdata(0,<span class="string">'SaccadeOptions'</span>);
0034 
0035     cla(PlotAxis(1));
0036     cla(PlotAxis(2));
0037     
0038    [sac,fx,fy]=<a href="../../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>(Trials(TrialIndex),SaccadeOptions.CorrectCode,SaccadeOptions.ISICut,SaccadeOptions.MinLat,1,gcf,SaccadeOptions.Threshold,[PlotAxis(1) PlotAxis(2)]);
0039    hold on;
0040    <a href="../../../XeX/UtilityFunctions/handlingGraphics/PlotCodes.html" class="code" title="function PlotCodes(Trial)">PlotCodes</a>(Trials(TrialIndex));
0041             
0042     <span class="keyword">if</span> ~isempty(is_fp)
0043         EarlyDrops=find(CurrentCodes&gt;=10700);
0044         <span class="keyword">if</span> length(EarlyDrops)&gt;=4
0045         FPx=(CurrentCodes(EarlyDrops(3))-11000)/10;
0046         FPy=(CurrentCodes(EarlyDrops(4))-11000)/10;
0047         <span class="keyword">end</span>
0048     <span class="keyword">end</span>
0049     
0050     <span class="keyword">if</span> ~isempty(is_reward), GoodTrial=1;
0051             RewTimeVar=CurrentTimes(find(CurrentCodes==1012));
0052     RewardTime=RewTimeVar(1);    
0053     <span class="keyword">elseif</span> ~isempty(is_error),
0054     ErrorTime=CurrentTimes(find(CurrentCodes==1013));
0055     <span class="keyword">end</span>
0056 
0057     <span class="keyword">if</span> ~isempty(is_fp), FPOnTime=CurrentTimes(is_fp(1));<span class="keyword">end</span>
0058     <span class="keyword">if</span> ~isempty(is_abort) AbortTrial=1;<span class="keyword">end</span>
0059     <span class="keyword">if</span> ~isempty(is_fixationbreak) FixationBreak=1;<span class="keyword">end</span>
0060     
0061     <span class="comment">%RF Properties</span>
0062     
0063     <span class="keyword">if</span> ~isempty(is_rf), RFOnTime=CurrentTimes(is_rf(1));
0064         
0065         <span class="keyword">if</span> ~isempty(is_rfoff)
0066             RFOffTime=CurrentTimes(is_rfoff(1));
0067         <span class="keyword">end</span>
0068         
0069         TemporaryVariable=find(abs(CurrentTimes-RFOnTime)&lt;5 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0070         <span class="keyword">if</span> ~isempty(TemporaryVariable), RFx=(CurrentCodes(TemporaryVariable(1))-6000)/10;<span class="keyword">end</span>
0071         <span class="keyword">if</span> ~isempty(TemporaryVariable), RFy=(CurrentCodes(TemporaryVariable(2))-6500)/10;<span class="keyword">end</span>
0072 
0073             
0074     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf) loop</span>
0075     
0076     <span class="keyword">if</span> ~isempty(is_rf2), RF2OnTime=CurrentTimes(is_rf2(1));
0077         TemporaryVariable=find(abs(CurrentTimes-RF2OnTime)&lt;100 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0078 
0079         <span class="keyword">if</span> ~isempty(TemporaryVariable), RF2x=(CurrentCodes(TemporaryVariable(1))-6000)/10;<span class="keyword">end</span>
0080         <span class="keyword">if</span> ~isempty(TemporaryVariable), RF2y=(CurrentCodes(TemporaryVariable(2))-6500)/10;<span class="keyword">end</span>
0081     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf2) loop</span>
0082         
0083 <span class="comment">%     keyboard;</span>
0084     
0085     axes(PlotAxis(3)); cla;
0086    
0087     h=plot(FPx,FPy,<span class="string">'ko'</span>);
0088     set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'k'</span>);
0089     hold on;
0090     h=plot(RF2x,RF2y,<span class="string">'bo'</span>);
0091     set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'b'</span>);
0092     set(gca,<span class="string">'xlim'</span>,[-25 25],<span class="string">'ylim'</span>,[-25 25],<span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickdir'</span>,<span class="string">'out'</span>);
0093 
0094     <span class="comment">%**********************this is where the visual search stuff is done</span>
0095     
0096    
0097             FindResult=find( <a href="inbetween.html" class="code" title="function y=inbetween(x,a,b,li,gi)">inbetween</a>(CurrentCodes,3001,3035) &amp; <a href="inbetween.html" class="code" title="function y=inbetween(x,a,b,li,gi)">inbetween</a>( CurrentTimes-RFOnTime,0,65) );
0098 
0099             <span class="keyword">if</span> length(FindResult)&gt;=1
0100                 NumStim=CurrentCodes(FindResult(1))-3000;
0101             <span class="keyword">else</span> NumStim=NaN;
0102             <span class="keyword">end</span>
0103             
0104             <span class="keyword">if</span> NumStim&gt;1
0105 
0106             <span class="comment">%using the checksize drop to catch all rf codes and to verify</span>
0107             <span class="comment">%numstim</span>
0108 
0109             FindResult=find( <a href="inbetween.html" class="code" title="function y=inbetween(x,a,b,li,gi)">inbetween</a>(CurrentCodes,10001,10010) &amp; <a href="inbetween.html" class="code" title="function y=inbetween(x,a,b,li,gi)">inbetween</a>(CurrentTimes-RFOnTime,0,65) );
0110 
0111             <span class="keyword">if</span> length(FindResult) &lt; NumStim, fprintf(<span class="string">'%s\n'</span>,<span class="string">'Something wrong with RF Code Drops, Not enough codes ?'</span>);
0112             <span class="keyword">elseif</span> length(FindResult)&gt;NumStim, FindResult=FindResult(1:NumStim);  <span class="comment">%only taking the first NumStim values</span>
0113             <span class="keyword">end</span>
0114 
0115             RFSet=repmat(struct(<span class="string">'number'</span>,nan,<span class="string">'x'</span>,nan,<span class="string">'y'</span>,nan,<span class="string">'pat'</span>,nan,<span class="string">'checksize'</span>,nan,<span class="string">'ord'</span>,nan,<span class="string">'fgr'</span>,nan,<span class="string">'fgg'</span>,nan,<span class="string">'fgb'</span>,nan),1,NumStim); <span class="comment">%initializing a structure to hold the rf property values</span>
0116 
0117             <span class="keyword">for</span> fillerindex=1:length(FindResult)    <span class="comment">%filling in using values obtained for FindResult</span>
0118 
0119                 RFSet(fillerindex).number=fillerindex;
0120                 RFSet(fillerindex).checksize=CurrentCodes(FindResult(fillerindex))-10000;
0121 
0122                 <span class="keyword">if</span> fillerindex==1, StartingIndex=is_rf(1); <span class="keyword">else</span> StartingIndex=FindResult(fillerindex-1);<span class="keyword">end</span>
0123 
0124                 FindResult2= find ( CodeIndices &gt; StartingIndex &amp; CodeIndices &lt; FindResult(fillerindex) &amp; CurrentCodes&gt;=5700 &amp; CurrentCodes&lt;=6800 );
0125                 RFSet(fillerindex).x=(CurrentCodes(FindResult2(1))-6000)/10;
0126                 RFSet(fillerindex).y=(CurrentCodes(FindResult2(2))-6500)/10;
0127 
0128                 FindResult2= find ( CodeIndices &gt; StartingIndex &amp; CodeIndices &lt; FindResult(fillerindex) &amp; CurrentCodes&gt;=7000 );
0129                 RFSet(fillerindex).pat=CurrentCodes(FindResult2(1))-7000;
0130 
0131                 StartingIndex=FindResult(fillerindex)-4;
0132 
0133                 FindResult2= find ( CodeIndices &gt; StartingIndex &amp; CodeIndices &lt; FindResult(fillerindex) &amp; CurrentCodes&gt;=5000 &amp; CurrentCodes&lt;=5855);
0134 <span class="comment">%                 fprintf('%d\t',length(FindResult2));</span>
0135 <span class="comment">%                 if length(FindResult2)==4, keyboard;end</span>
0136                 <span class="keyword">if</span> length(FindResult2)==3
0137                     RFSet(fillerindex).fgr=CurrentCodes(FindResult2(1))-5000;
0138                     RFSet(fillerindex).fgg=CurrentCodes(FindResult2(2))-5300;
0139                     RFSet(fillerindex).fgb=CurrentCodes(FindResult2(3))-5600;
0140                 <span class="keyword">end</span>
0141 
0142             <span class="keyword">end</span>  <span class="comment">%     ending -&gt;   for fillerindex=1:length(FindResult)</span>
0143 
0144             RFangs=atan2([RFSet.y],[RFSet.x]);
0145             RFangs(RFangs&lt;0)=2*pi+RFangs(RFangs&lt;0);
0146             [SortedAngs,SortedIndices]=sort(RFangs);
0147 
0148             <span class="keyword">for</span> SortedIndex=1:length(SortedIndices)
0149                 RFSet(SortedIndices(SortedIndex)).ord=SortedIndex-1; <span class="comment">%start at 0</span>
0150             <span class="keyword">end</span>
0151 
0152             WhereisTarget=find([RFSet.pat]==28 | [RFSet.pat]==29);
0153             <span class="keyword">if</span> ~isempty(WhereisTarget)
0154                 TargX=RFSet(WhereisTarget).x;
0155                 TargY=RFSet(WhereisTarget).y;
0156             <span class="keyword">end</span>
0157             
0158             MaxGreen=nanmax([RFSet.fgg]);
0159             WhereisPop=find([RFSet.fgg]==MaxGreen);  <span class="comment">%KLUGE : green 255 is popout</span>
0160             <span class="keyword">if</span> ~isempty(WhereisPop)
0161                 PopX=RFSet(WhereisPop).x;
0162                 PopY=RFSet(WhereisPop).y;
0163             <span class="keyword">end</span>
0164             
0165             h=plot([RFSet.x],[RFSet.y],<span class="string">'bo'</span>);
0166             set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'b'</span>);
0167             h=plot(PopX,PopY,<span class="string">'bo'</span>);
0168             set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'g'</span>);
0169             h=plot(TargX,TargY,<span class="string">'ko'</span>);
0170             set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'k'</span>);
0171             
0172             <span class="keyword">else</span>
0173                     h=plot(RFx,RFy,<span class="string">'ro'</span>);
0174                     set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'r'</span>);
0175             <span class="keyword">end</span>
0176             <span class="comment">%**************************************************************</span>
0177     
0178     h=plot(fx(6:end),fy(6:end),<span class="string">'g-'</span>);
0179     set(h,<span class="string">'linewidth'</span>,2)
0180 <span class="comment">%     keyboard;</span>
0181  
0182 <span class="keyword">if</span>(SaccadeOptions.CorrectCode==1003)
0183     
0184 <span class="keyword">if</span> ~isnan(RFOnTime)
0185 h=plot(fx(RFOnTime-FPOnTime-5),fy(RFOnTime-FPOnTime-5),<span class="string">'ro'</span>);
0186 set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'r'</span>);
0187 <span class="keyword">end</span>
0188 
0189 <span class="keyword">if</span> ~isnan(RF2OnTime),
0190     h=plot(fx(RF2OnTime-FPOnTime-5),fy(RF2OnTime-FPOnTime-5),<span class="string">'bo'</span>);
0191 set(h,<span class="string">'markerfacecolor'</span>,<span class="string">'r'</span>);
0192 <span class="keyword">end</span>
0193 <span class="keyword">end</span>
0194 
0195 <span class="keyword">if</span> ~isempty(is_reward), title(<span class="string">'GoodTrial==1'</span>);
0196 <span class="keyword">elseif</span> ~isempty(is_fixationbreak), title(<span class="string">'FixationBreak==1'</span>);
0197 <span class="keyword">elseif</span> ~isempty(is_abort), title(<span class="string">'Abort==1'</span>);
0198 <span class="keyword">elseif</span> ~isempty(is_error), title(<span class="string">'BadTrial==1'</span>);
0199 <span class="keyword">end</span>
0200 
0201 <span class="keyword">end</span>   <span class="comment">%ending main loop</span>
0202 
0203 zoom on
0204</pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>