<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of UpdateCellOrLoadGFX</title>
  <meta name="keywords" content="UpdateCellOrLoadGFX">
  <meta name="description" content="this script does all the hard work for updating a cell or loading">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html XeX --><!-- ../menu.html UtilityFunctions --><!-- menu.html update -->
<h1>UpdateCellOrLoadGFX
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>this script does all the hard work for updating a cell or loading</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">     this script does all the hard work for updating a cell or loading
     graphix
   commenting and fixing: 05/12/21</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../XeX/UtilityFunctions/assorted/TellMe.html" class="code" title="function TellMe(formatvar,stringvar,speakvar)">TellMe</a>	This function uses tts to speak out the stringvar if speaktovar is set, else fprintfs it to cmd window</li><li><a href="../../../XeX/UtilityFunctions/assorted/clearvars.html" class="code" title="">clearvars</a>	This function clears all the variables that were recently detached</li><li><a href="../../../XeX/UtilityFunctions/assorted/detachvars.html" class="code" title="">detachvars</a>	This script detaches all the variables from a structure and assigns them</li><li><a href="../../../XeX/UtilityFunctions/gettingAndsettingParameters/MakeTempGraphix.html" class="code" title="">MakeTempGraphix</a>	This scriptlet assembles the TempGraphix structure for saving</li><li><a href="../../../XeX/UtilityFunctions/gettingAndsettingParameters/evalAlignTime.html" class="code" title="">evalAlignTime</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../XeX/XeX.html" class="code" title="function varargout = XeX(varargin)">XeX</a>	XEX M-file for XeX.fig</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 
0002 <span class="comment">%     this script does all the hard work for updating a cell or loading</span>
0003 <span class="comment">%     graphix</span>
0004 <span class="comment">%   commenting and fixing: 05/12/21</span>
0005 
0006 <span class="comment">%getting axes to update list</span>
0007 
0008 AxesToUpdateStr=get(handles.UseTheseAxes,<span class="string">'string'</span>);
0009 <span class="keyword">if</span> isempty(AxesToUpdateStr), AxesToUpdateStr=<span class="string">'[]'</span>;<span class="keyword">end</span>
0010 eval([<span class="string">'CurrentAxesToUpdate='</span> AxesToUpdateStr <span class="string">';'</span>]);
0011 <span class="keyword">if</span> LoadGFXVar==1, CurrentAxesToUpdate=1:handles.NumberOfAxes;<span class="keyword">end</span>
0012 
0013 <span class="comment">%**********     GETTING VALUES FOR OPTION VARIABLES ***************</span>
0014 <span class="keyword">if</span> strcmp(get(handles.PlotLatency,<span class="string">'checked'</span>),<span class="string">'on'</span>) CurrentPlotLatency=1; <span class="keyword">else</span> CurrentPlotLatency=0;<span class="keyword">end</span>
0015 CurrentLatInit=handles.LatInitTime;
0016 <span class="keyword">if</span> strcmp(get(handles.PlotCB,<span class="string">'checked'</span>),<span class="string">'on'</span>) CurrentPlotCB=1; <span class="keyword">else</span> CurrentPlotCB=0;<span class="keyword">end</span>
0017 <span class="keyword">if</span> strcmp(get(handles.PlotSig,<span class="string">'checked'</span>),<span class="string">'on'</span>) CurrentPlotSig=1; <span class="keyword">else</span> CurrentPlotSig=0;<span class="keyword">end</span>
0018 
0019  CurrentHoldStatus=get(handles.HoldStatus,<span class="string">'Value'</span>);
0020  <span class="keyword">if</span> strcmp(get(handles.SpikeTruncate,<span class="string">'checked'</span>),<span class="string">'off'</span>), CurrentAnalogCorrect=0; <span class="keyword">else</span> CurrentAnalogCorrect=1;<span class="keyword">end</span>
0021 CurrentUseProps=0;  <span class="comment">%not really used, just for completeness</span>
0022 <span class="comment">%*********************************************************************</span>
0023 
0024 <span class="comment">%**********     GETTING VALUES FOR CELL VARIABLES ***************</span>
0025  
0026    CurrentUnitNumber=handles.UnitNumber;
0027    CurrentRF=handles.RFLocation;
0028 
0029    <span class="comment">%getting current data and data file -&gt;.keeping this a single data file at the moment as well</span>
0030  LoadedFileList=get(handles.LoadedFiles,<span class="string">'string'</span>);
0031  <span class="keyword">if</span> ~iscell(LoadedFileList), LoadedFileList={LoadedFileList}; <span class="keyword">end</span>
0032  CurrentValue=get(handles.LoadedFiles,<span class="string">'value'</span>); CurrentValue=CurrentValue(1);
0033  CurrentDataFile=LoadedFileList{CurrentValue};
0034  
0035  <span class="keyword">if</span> ~strcmp(CurrentDataFile,<span class="string">'LoadedFiles'</span>)
0036      
0037   eval([<span class="string">'if ~isfield(handles.'</span> CurrentDataFile <span class="string">',''Analysis''), fprintf(''%s\n'',''Analyze your dataset first''); GoOn=0;else GoOn=1;end'</span>]);
0038 
0039   eval([<span class="keyword">...</span>
0040         <span class="string">'Trials=handles.'</span> CurrentDataFile <span class="string">'.Trials;'</span><span class="keyword">...</span>
0041         <span class="string">'CurrentVariables=handles.'</span> CurrentDataFile <span class="string">'.Analysis;'</span><span class="keyword">...</span>
0042         ]);
0043  <span class="keyword">else</span> <a href="../../../XeX/UtilityFunctions/assorted/TellMe.html" class="code" title="function TellMe(formatvar,stringvar,speakvar)">TellMe</a>(<span class="string">'%s\n'</span>,<span class="string">'Load a File first'</span>,handles.SpeakToMe); GoOn=0;
0044  <span class="keyword">end</span>
0045      
0046  
0047 <span class="comment">%*********************************************************************</span>
0048  
0049 
0050 <span class="comment">%    This is the list of saved variables for each figure</span>
0051 
0052 <span class="comment">%UNUSED:</span>
0053 <span class="comment">% handle</span>
0054 <span class="comment">% dataset</span>
0055 
0056 <span class="comment">%CELL VARIABLES:</span>
0057 <span class="comment">% unitnumber</span>
0058 <span class="comment">% rf</span>
0059 
0060 <span class="comment">%AXIS VARIABLES</span>
0061 <span class="comment">% xaxisvariablestr</span>
0062 <span class="comment">% x1axisvariablestr</span>
0063 <span class="comment">% yaxismeasurestr</span>
0064 <span class="comment">% discretizex</span>
0065 <span class="comment">% discretizex1</span>
0066 <span class="comment">% xaxiscenters</span>
0067 <span class="comment">% x1axiscenters</span>
0068 
0069 <span class="comment">%IMPORTANT</span>
0070 <span class="comment">% evalstring</span>
0071 <span class="comment">% markerstring</span>
0072 <span class="comment">% binwidth</span>
0073 <span class="comment">% timevector</span>
0074 <span class="comment">% trialfilter</span>
0075 <span class="comment">% alignstring</span>
0076 <span class="comment">% currentvariable</span>
0077 <span class="comment">% timewindowvector</span>
0078 <span class="comment">% slidervalue</span>
0079 <span class="comment">% plottype</span>
0080 
0081 <span class="comment">%********** IF DATA EXIST, THEN ANALYZE ***************</span>
0082 
0083 <span class="keyword">if</span> GoOn==1
0084       
0085 <span class="keyword">for</span> UpdateIndex=1:length(CurrentAxesToUpdate)
0086     
0087     <span class="comment">%FIND CURRENT AXIS</span>
0088     
0089     CurrentAxis=CurrentAxesToUpdate(UpdateIndex);
0090     CUStr=num2str(CurrentAxis);
0091     eval([<span class="string">'axes(handles.axes'</span> CUStr <span class="string">');'</span>]);
0092     fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Updating axis  '</span> CUStr]);
0093     
0094     <span class="comment">%FIND CURRENT OBJECT LIST</span>
0095     
0096     eval([<span class="string">'if isfield(handles,''A'</span> CUStr <span class="string">'''), CurrentObjects=handles.A'</span> CUStr <span class="string">';else CurrentObjects=[];end'</span>]);  <span class="comment">%getting the current objects</span>
0097     
0098     <span class="comment">%CLEAR AXIS, MAKE TITLES, ETC</span>
0099     
0100 <span class="keyword">if</span>(CurrentHoldStatus~=1), cla; hold off; <span class="keyword">else</span> hold on; <span class="keyword">end</span>
0101     title(<span class="string">''</span>); xlabel(<span class="string">''</span>); ylabel(<span class="string">''</span>);
0102     eval([<span class="string">'if isfield(handles,''A'</span> CUStr <span class="string">'Annotations''), CurrentAnnotation=handles.A'</span> CUStr <span class="string">'Annotations;else CurrentAnnotation=[];end'</span>]);  <span class="comment">%getting the current annotations</span>
0103     
0104     <span class="comment">%REDO EACH OBJECT IN THIS LOOP</span>
0105     
0106         <span class="keyword">for</span> ObjectIndex=1:length(CurrentObjects)
0107 
0108 <span class="comment">%             if (LoadGFXVar==1&amp;&amp;CurrentObjects(ObjectIndex).newgraph==1) || (LoadGFXVar~=1)</span>
0109            
0110 <span class="keyword">if</span> LoadGFXVar~=1
0111      
0112                 <span class="comment">%GETTING ALL RELEVANT SAVED VARIABLES</span>
0113             
0114 <span class="comment">%         SavedDataFile=CurrentObjects(ObjectIndex).dataset;</span>
0115 <span class="comment">%         SavedHandle=CurrentObjects(ObjectIndex).handle;</span>
0116 
0117         SavedEvalString=CurrentObjects(ObjectIndex).evalstring;
0118         NextMarker=CurrentObjects(ObjectIndex).markerstring;
0119         CurrentBinWidth=CurrentObjects(ObjectIndex).binwidth;
0120         CurrentSliderValue=CurrentObjects(ObjectIndex).slidervalue;
0121         CurrentStimVector=CurrentObjects(ObjectIndex).timevector;
0122          XVector=CurrentStimVector(1):CurrentBinWidth:CurrentStimVector(2);
0123         PlotXVector=[(CurrentStimVector(1)+(CurrentBinWidth/2)):CurrentBinWidth:(CurrentStimVector(2)+(CurrentBinWidth/2))];
0124         CurrentFilterString=CurrentObjects(ObjectIndex).trialfilter;
0125         CurrentAlignString=CurrentObjects(ObjectIndex).alignstring;
0126         SavedAlignString=CurrentAlignString;
0127         SavedVariable=CurrentObjects(ObjectIndex).currentvariable;
0128         CurrentSelectedVariable=SavedVariable;
0129         SavedErrorBarType=CurrentObjects(ObjectIndex).errorbartype;
0130         CurrentErrorBarType=SavedErrorBarType;
0131         SavedPValue=CurrentObjects(ObjectIndex).pvalue;
0132         CurrentPValue=SavedPValue;
0133 
0134         LocalMarkerString=NextMarker;
0135         TimeWindowVector=CurrentObjects(ObjectIndex).timewindowvector;
0136 
0137         CurrentXAxisVariableStr=CurrentObjects(ObjectIndex).xaxisvariablestr;
0138         CurrentX1AxisVariableStr=CurrentObjects(ObjectIndex).x1axisvariablestr;
0139         CurrentYAxisVariableStr=CurrentObjects(ObjectIndex).yaxisvariablestr;
0140         CurrentXAxisDiscretize=CurrentObjects(ObjectIndex).discretizex;
0141         CurrentX1AxisDiscretize=CurrentObjects(ObjectIndex).discretizex1;
0142         CurrentXAxisCentersStr=CurrentObjects(ObjectIndex).xaxiscenters;
0143         CurrentX1AxisCentersStr=CurrentObjects(ObjectIndex).x1axiscenters;        
0144         
0145         CurrentPlotType=CurrentObjects(ObjectIndex).plottype;
0146 
0147         <span class="comment">%getting data from cell</span>
0148         
0149        <a href="../../../XeX/UtilityFunctions/assorted/detachvars.html" class="code" title="">detachvars</a>;    
0150 
0151 <span class="comment">%        setAlignTime;</span>
0152        <a href="../../../XeX/UtilityFunctions/gettingAndsettingParameters/evalAlignTime.html" class="code" title="">evalAlignTime</a>;
0153        
0154 eval([<span class="string">'CurrentFilterVector='</span> CurrentFilterString <span class="string">';'</span>]); <span class="comment">%this does the current filter vector</span>
0155 eval(SavedEvalString); hold on;
0156 EvalString=SavedEvalString;
0157 CurrentDisplayFilterString=CurrentFilterString;
0158 <a href="../../../XeX/UtilityFunctions/gettingAndsettingParameters/MakeTempGraphix.html" class="code" title="">MakeTempGraphix</a>;
0159 
0160 NStr=num2str(CurrentAxis);
0161 
0162 <span class="keyword">if</span> LoadGFXVar~=1 &amp;&amp; CurrentHoldStatus==1  <span class="comment">%now here, evaluate the eval string and set the handles.a1 structure to include the new object</span>
0163 eval([<span class="string">'handles.A'</span> NStr <span class="string">'(length(handles.A'</span> NStr <span class="string">')+1)=TempGraphix;'</span>]);
0164         <span class="keyword">else</span>                                   <span class="comment">%here, evaluate the eval string, and replace the handles.a1(xx) structure with the new graphics object</span>
0165 eval([<span class="string">'handles.A'</span> NStr <span class="string">'(ObjectIndex)=TempGraphix;'</span>]);
0166         <span class="keyword">end</span>
0167 
0168         <a href="../../../XeX/UtilityFunctions/assorted/clearvars.html" class="code" title="">clearvars</a>;
0169 <span class="keyword">end</span>
0170 
0171   
0172      <span class="keyword">if</span> ~isempty(CurrentAnnotation), title(CurrentAnnotation{1}); 
0173          <span class="keyword">if</span> length(CurrentAnnotation)&gt;1,xlabel(CurrentAnnotation{2});<span class="keyword">end</span>
0174          <span class="keyword">if</span> length(CurrentAnnotation)&gt;2,ylabel(CurrentAnnotation{3});<span class="keyword">end</span> <span class="comment">%change on feb 20</span>
0175      <span class="keyword">end</span>
0176      
0177 <span class="comment">%      if ~isempty(CurrentAnnotation), title(CurrentAnnotation{1}); xlabel(CurrentAnnotation{2}); ylabel(CurrentAnnotation{3});end</span>
0178         <span class="keyword">end</span>
0179 <span class="keyword">end</span><span class="comment">%ending the current axis loop</span>
0180 
0181  <span class="keyword">end</span> <span class="comment">%ending the GoOn Loop</span></pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>