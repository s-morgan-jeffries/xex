<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of SpikeDensityFunction</title>
  <meta name="keywords" content="SpikeDensityFunction">
  <meta name="description" content="SpikeDensityFunction.m convolves a gaussian with spikes, outputs Spike Density Functions">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html XeX --><!-- ../menu.html UtilityFunctions --><!-- menu.html plotting -->
<h1>SpikeDensityFunction
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SpikeDensityFunction.m convolves a gaussian with spikes, outputs Spike Density Functions</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [spikesOut,spikeSD,gaus]=SpikeDensityFunction(spikesIn,sigma,binwidth,errtype) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">     SpikeDensityFunction.m convolves a gaussian with spikes, outputs Spike Density Functions
     - sigma is the stdev of the gaussian
    Each trial is a row
     [spikesOut,spikeSD,gaus]=SpikeDensityFunction(spikesIn,sigma,binwidth,errtype)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../XeX/AnalysisFunctions/Analysis/AnalPSTD.html" class="code" title="">AnalPSTD</a>	Script to do analysis for PlotPSTD; callable outside Xex</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [spikesOut,spikeSD,gaus]=SpikeDensityFunction(spikesIn,sigma,binwidth,errtype)</a>
0002 
0003 <span class="comment">%     SpikeDensityFunction.m convolves a gaussian with spikes, outputs Spike Density Functions</span>
0004 <span class="comment">%     - sigma is the stdev of the gaussian</span>
0005 <span class="comment">%    Each trial is a row</span>
0006 <span class="comment">%     [spikesOut,spikeSD,gaus]=SpikeDensityFunction(spikesIn,sigma,binwidth,errtype)</span>
0007 
0008 <span class="comment">% originally: Jay Edelman, followed by Nicholas Port (9/22/99) and JWB</span>
0009 <span class="comment">% (7/21/00)</span>
0010 <span class="comment">%SE code from chronux's PSTH function</span>
0011 <span class="comment">%Various other modifications for data formatting purposes.</span>
0012 
0013 <span class="comment">% keyboard;</span>
0014 
0015 <span class="keyword">if</span> ~exist(<span class="string">'sigma'</span>,<span class="string">'var'</span>), sigma=50;<span class="keyword">end</span>
0016 <span class="keyword">if</span> ~exist(<span class="string">'binwidth'</span>,<span class="string">'var'</span>), binwidth=1;<span class="keyword">end</span>
0017 NumberOfBootSamples=40;
0018 
0019 spikes=spikesIn;  <span class="comment">%converting to column format; each trial in one column; time in a row.  No, no need. No practical advantage to columns, though people claim there is.</span>
0020 
0021 <span class="keyword">if</span> size(spikes,1)&gt;size(spikes,2), fprintf(<span class="string">'%s\n'</span>,<span class="string">'More trials than time bins. Sure ?'</span>); <span class="keyword">end</span>
0022 
0023 sigma=sigma/binwidth;
0024 
0025 dist=(-(sigma*3):(sigma*3));  <span class="comment">% Increased to 10 from 7, just because - BSK November 7 2005; no suffer from edge effects then. not so long</span>
0026                                                 <span class="comment">%now with 5 ms smoothing,</span>
0027                                                 <span class="comment">%lose 30 ms total only</span>
0028 gaus=1/(sigma*sqrt(2*pi))*exp(-((dist.^2)/(2*sigma^2)));
0029 <span class="comment">%  keyboard;</span>
0030 spikes=conv2(spikes,gaus);             <span class="comment">%conv2C is luigi rossa's conv2olam from matlab central,</span>
0031                                                            <span class="comment">% uses overlap add ffts. conv2B and conv2A suck.</span>
0032                                                            <span class="comment">%remember to extract the valid points out of this in plotpstd. conv2 is unpredictable: sometimes lightning, other times, seconds !! conv2C is more predictable.</span>
0033                                                            <span class="comment">%aaaargh. but it gets confused when there are NaNs. back to conv2</span>
0034                                                            
0035 spikesOut=nanmean(spikes) * 1000 / binwidth;  <span class="comment">%mean PSTH in correct units</span>
0036 
0037 spikesOut=spikesOut+1e-10; <span class="comment">%to remove tiny 1e-15 order negative values produced by conv2C</span>
0038 
0039 
0040 <span class="keyword">if</span> ~exist(<span class="string">'errtype'</span>,<span class="string">'var'</span>) || errtype==1
0041 <span class="comment">%    std dev is sqrt(rate*(integral over kernal^2)/trials)</span>
0042 <span class="comment">%    for Gaussian integral over Kernal^2 is 1/(2*sig*srqt(pi))</span>
0043 <span class="comment">%we should get the integral numerically and use that.</span>
0044 <span class="comment">% so variance is sqrt ( rate * integral_of_kernelsquared ) / sqrt</span>
0045 <span class="comment">% (numtrials)</span>
0046 
0047 <span class="comment">%   poissSD= sqrt(spikesOut/(2*size(spikesOut,2)*sigma*sqrt(pi)));</span>
0048 nantester=spikes;
0049 nantester(~isnan(nantester))=1;
0050 summat=nansum(nantester);
0051 summat(summat==0)=nan;
0052 
0053 <span class="comment">% poissSD=sqrt(spikesOut *  ( trapz(gaus.^2)  * 1000 / binwidth ) / size(spikes,1) );</span>
0054 poissSD=sqrt(spikesOut *  ( trapz(gaus.^2)  * 1000 / binwidth ) ./ summat  );
0055 spikeSD=poissSD;
0056 <span class="comment">% if any(find(isnan(spikes))), keyboard;end</span>
0057 
0058 <span class="keyword">else</span>
0059     <span class="comment">%bootstrp takes in data with each row being one instance; so here each trial is a row.</span>
0060     <span class="comment">%then simply compute mean... this gives you a vector for that sample</span>
0061     <span class="comment">%each row will then contain the trial psth effectively</span>
0062     <span class="comment">%just calculate variance in one go at the end and include it</span>
0063     <span class="comment">%interestingly can compare mean to bootstrap mean; there should be no</span>
0064     <span class="comment">%bias :) or does boot show bias ?</span>
0065     
0066 
0067 BootMat=bootstrp(NumberOfBootSamples,<span class="string">'nanmean'</span>,spikes);
0068   bootSD=nanstd(BootMat);
0069   spikeSD=bootSD*1000/binwidth;  <span class="comment">% also converted to right units now</span>
0070 <span class="keyword">end</span>
0071 
0072 <span class="comment">% keyboard;</span></pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>