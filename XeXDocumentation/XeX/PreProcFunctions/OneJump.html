<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of OneJump</title>
  <meta name="keywords" content="OneJump">
  <meta name="description" content="This function analyzes trials from the Jump paradigms">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html XeX --><!-- menu.html PreProcFunctions -->
<h1>OneJump
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This function analyzes trials from the Jump paradigms</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function CurrentVariables=OneJump(Trials,klugestring,UseAx,SacOpts) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">    This function analyzes trials from the Jump paradigms
    CurrentVariables=OneJump(Trials,klugestring,UseAx,SacOpts)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>	A little scriplet that does</li><li><a href="../../XeX/UtilityFunctions/assorted/CreateTempSac.html" class="code" title="">CreateTempSac</a>	This scriptlet is used in OneJump, for instance.</li><li><a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>	function SacStruct=MakeSacStruct(WhichType)</li><li><a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>	This script evaluates what variables are present in the calling</li><li><a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>	This function takes in a vector (or a matrix) , and returns unique values (or rows). NaNs (and rows with NaNs) are removed.</li><li><a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>	this function takes in a vector and discretizes it, by finding the closest</li><li><a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>	The main XeX saccade parser</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function CurrentVariables=OneJump(Trials,klugestring,UseAx,SacOpts)</a>
0002 
0003 <span class="comment">%    This function analyzes trials from the Jump paradigms</span>
0004 <span class="comment">%    CurrentVariables=OneJump(Trials,klugestring,UseAx,SacOpts)</span>
0005 
0006 
0007 <span class="comment">%Initializing Variables</span>
0008 
0009 ArrayNumber=nan*ones(1,length(Trials));
0010 GoodTrial=ArrayNumber;
0011 BadTrial=ArrayNumber;
0012 PhotoBad=ArrayNumber;
0013 RFPhotoBad=ArrayNumber;
0014 GotToGap=ArrayNumber;
0015 TrialNumber=1:length(Trials);
0016 
0017 AbortTrial=ArrayNumber;
0018 FixationBreak=ArrayNumber;
0019 
0020 RewardTime=ArrayNumber;
0021 RewardDur=ArrayNumber;
0022 ErrorTime=ArrayNumber;
0023 RFOnTime=ArrayNumber;
0024 RFOffTime=ArrayNumber;
0025 RFx=ArrayNumber;
0026 RFy=ArrayNumber;
0027 RFTrialIndex=ArrayNumber;
0028 RFChecksize=ArrayNumber;
0029 
0030 Jumpx=ArrayNumber;
0031 Jumpy=ArrayNumber;
0032 
0033 RFRed=ArrayNumber;
0034 RFGreen=ArrayNumber;
0035 RFBlue=ArrayNumber;
0036 
0037 RF2OnTime=ArrayNumber;
0038 RF2OffTime=ArrayNumber;
0039 RF2Checksize=ArrayNumber;
0040 RF2x=RF2OnTime;
0041 RF2y=RF2OnTime;
0042 RF2Red=ArrayNumber;
0043 RF2Green=ArrayNumber;
0044 RF2Blue=ArrayNumber;
0045 RF2isRed=ArrayNumber;
0046 RF2isGreen=ArrayNumber;
0047 MarkerCode=ArrayNumber;
0048 FPx=RFx;
0049 FPy=RFy;
0050 
0051 RGood=ArrayNumber;
0052 
0053 <span class="keyword">if</span> ~exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>) | (exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>)  &amp; isempty(strfind(klugestring,<span class="string">'z050808'</span>)))
0054 FPx(:)=0;
0055 FPy(:)=0;
0056 <span class="keyword">end</span>
0057 
0058 FPOnTime=RFy;
0059 
0060 WTF=ArrayNumber;
0061 
0062 SacEndX1=ArrayNumber;
0063 SacEndY1=ArrayNumber;
0064 
0065 GapTime=ArrayNumber;
0066 
0067 fprintf(<span class="string">'%s\n'</span>,<span class="string">'Storing sacs'</span>);
0068 Sacs=cell(1,length(ArrayNumber));
0069 
0070 JNumSacs=ArrayNumber; <span class="comment">%number of saccades between gap on and reward</span>
0071 JWhichSac=ArrayNumber;
0072 
0073 TempSacStruct=<a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>(2);
0074 FPToRF2Sac=repmat(TempSacStruct,1,length(Trials));
0075 FromRF2Sac=FPToRF2Sac;
0076 FromFPSac=FPToRF2Sac;
0077 ToRF2Sac=FPToRF2Sac;
0078 ToRFSac=FPToRF2Sac;
0079 ToFPSac=FPToRF2Sac;
0080 FirstGapSac=FPToRF2Sac;
0081 
0082 FPToRF2=ArrayNumber;
0083 ToRF2=ArrayNumber;
0084 ToRF=ArrayNumber;
0085 
0086 HowManySacs=ArrayNumber;
0087 SaccadicLatency=ArrayNumber;
0088 HowManyFinSacs=ArrayNumber;
0089 FinWhichSac=ArrayNumber;
0090 FinWhichSacLat=ArrayNumber;
0091 Curv=ArrayNumber;
0092 FirstDSac=ArrayNumber;
0093 FirstDSacLat=ArrayNumber;
0094 HowManyDSacs=ArrayNumber;
0095 
0096 ArrayBak=[];   <span class="comment">%for ArrayFiddleCodeBit</span>
0097 
0098 MyVariableList={<span class="string">'ArrayNumber'</span>,<span class="string">'GoodTrial'</span>,<span class="string">'BadTrial'</span>,<span class="string">'PhotoBad'</span>,<span class="string">'RGood'</span>,<span class="string">'TrialNumber'</span>,<span class="string">'AbortTrial'</span>,<span class="keyword">...</span>
0099     <span class="string">'FixationBreak'</span>,<span class="string">'RewardTime'</span>,<span class="string">'ErrorTime'</span>,<span class="string">'RFOnTime'</span>,<span class="string">'RFOffTime'</span>,<span class="string">'RFx'</span>,<span class="string">'RFy'</span>,<span class="string">'RFTrialIndex'</span>,<span class="string">'RF2OnTime'</span>,<span class="keyword">...</span>
0100     <span class="string">'RF2x'</span>,<span class="string">'RF2y'</span>,<span class="string">'FPx'</span>,<span class="string">'FPy'</span>,<span class="string">'FPOnTime'</span>,<span class="string">'WTF'</span>,<span class="string">'GapTime'</span>,<span class="string">'JNumSacs'</span>,<span class="string">'JWhichSac'</span>,<span class="string">'TrueGood'</span>,<span class="string">'RFEccentricity'</span>,<span class="keyword">...</span>
0101     <span class="string">'RF2dist_toRF'</span>,<span class="string">'RFGood'</span>,<span class="string">'SacRelRFOn'</span>,<span class="string">'SacRelRFOff'</span>,<span class="string">'JumpSacTime'</span>,<span class="string">'RFLat'</span>,<span class="string">'dRFLat'</span>,<span class="string">'RFSacLat'</span>,<span class="string">'SacLat'</span>,<span class="keyword">...</span>
0102     <span class="string">'RFSacLat_Cor'</span>,<span class="string">'RFChecksize'</span>,<span class="string">'RF2Checksize'</span>,<span class="string">'RFRed'</span>,<span class="string">'RFGreen'</span>,<span class="string">'RFBlue'</span>,<span class="string">'MarkerCode'</span>,<span class="string">'HowManySacs'</span>,<span class="keyword">...</span>
0103     <span class="string">'HowManyFinSacs'</span>,<span class="string">'FinWhichSac'</span>,<span class="string">'FinWhichSacLat'</span>,<span class="string">'FirstDSac'</span>,<span class="string">'FirstDSacLat'</span>,<span class="string">'Curv'</span>,<span class="string">'SacEndX1'</span>,<span class="string">'SacEndY1'</span>};
0104 MyResponseVariableList={<span class="string">'GoodTrial'</span>};
0105 
0106 
0107 <span class="keyword">for</span> TrialIndex=1:length(Trials)
0108     
0109     <span class="keyword">if</span> rem(TrialIndex,500)==0, fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Finished   '</span> num2str(TrialIndex) <span class="string">'  Trials'</span>]);<span class="keyword">end</span>
0110     
0111     CurrentEvents=Trials(TrialIndex).Events;
0112     CurrentCodes=double([CurrentEvents.Code]);
0113     CurrentTimes=double([CurrentEvents.Time]);
0114     CodeIndex=1:length(CurrentCodes);
0115     
0116     RFTrialIndex(TrialIndex)=TrialIndex;
0117     
0118     is_reward=find(CurrentCodes==1012);
0119     is_error=find(CurrentCodes==1013);
0120     is_fp=find(CurrentCodes==1003);
0121     is_rf=find(CurrentCodes==1007);
0122     is_rfoff=find(CurrentCodes==1010);
0123     is_photobad=find(CurrentCodes==1092);
0124     is_abort=find(CurrentCodes==1090);
0125     is_fixationbreak=find(CurrentCodes==1091);
0126     is_gap=find(CurrentCodes==1004);
0127     is_rf2=find(CurrentCodes==1047);
0128     is_rf2off=find(CurrentCodes==1040);
0129     is_jump=find(CurrentCodes==1005);
0130     
0131     <span class="keyword">if</span> ~isempty(is_gap), GotToGap(TrialIndex)=1;<span class="keyword">end</span> <span class="comment">%this will help estimate percentage of saccades to distractor</span>
0132     
0133         <span class="keyword">if</span> ~isempty(is_reward) &amp;&amp; ~isempty(is_error), WTF(TrialIndex)=100;<span class="keyword">end</span>
0134         <span class="keyword">if</span> length(is_reward)&gt;1, WTF(TrialIndex)=101;<span class="keyword">end</span>
0135             
0136     <span class="keyword">if</span> ~isempty(is_fp)
0137         EarlyDrops=find(CurrentCodes&gt;=10700);
0138         <span class="keyword">if</span> length(EarlyDrops)&gt;=4
0139         MarkerCode(TrialIndex)=(CurrentCodes(EarlyDrops(1))-11000);
0140             FPx(TrialIndex)=(CurrentCodes(EarlyDrops(3))-11000)/10;
0141         FPy(TrialIndex)=(CurrentCodes(EarlyDrops(4))-11000)/10;
0142         <span class="keyword">end</span>
0143         <span class="keyword">if</span> length(EarlyDrops)&gt;=9
0144             RewardDur(TrialIndex)=(CurrentCodes(EarlyDrops(9))-11000);
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147     
0148     <span class="keyword">if</span> ~isempty(is_reward), GoodTrial(TrialIndex)=1;
0149             RewTimeVar=CurrentTimes(find(CurrentCodes==1012));
0150     RewardTime(TrialIndex)=RewTimeVar(1);    
0151     <span class="keyword">elseif</span> ~isempty(is_error),
0152     ErrorTime(TrialIndex)=CurrentTimes(find(CurrentCodes==1013));
0153     <span class="keyword">end</span>
0154 
0155     <span class="keyword">if</span> ~isempty(is_fp), FPOnTime(TrialIndex)=CurrentTimes(is_fp(1));<span class="keyword">end</span>
0156     <span class="keyword">if</span> ~isempty(is_photobad), PhotoBad(TrialIndex)=1;<span class="keyword">end</span>
0157     <span class="keyword">if</span> ~isempty(is_abort) AbortTrial(TrialIndex)=1;<span class="keyword">end</span>
0158     <span class="keyword">if</span> ~isempty(is_fixationbreak) FixationBreak(TrialIndex)=1;<span class="keyword">end</span>
0159     
0160     <span class="comment">%RF Properties</span>
0161 
0162     
0163     <span class="keyword">if</span> ~isempty(is_rf), RFOnTime(TrialIndex)=CurrentTimes(is_rf(1));
0164     
0165             is_rfphotobad=find(CurrentCodes==1092&amp;CurrentTimes&gt;=RFOnTime(TrialIndex)); <span class="comment">%note that if rf is not present, rfphotobad will not report either</span>
0166 
0167             <span class="keyword">if</span> ~isempty(is_rfphotobad) RFPhotoBad(TrialIndex)=1;<span class="keyword">end</span>
0168         
0169                FindResult=find(CurrentCodes&gt;=10000 &amp; abs(CurrentTimes-RFOnTime(TrialIndex))&lt;5);
0170           <span class="keyword">if</span> length(FindResult)&gt;=1
0171               RFChecksize(TrialIndex)=nanmin(CurrentCodes(FindResult)-10000); <span class="keyword">end</span>  
0172 
0173                   TemporaryVariable=find(abs(CurrentTimes-RFOnTime(TrialIndex))&lt;5 &amp; CurrentCodes&lt;=5255&amp;CurrentCodes&gt;=5000);
0174         <span class="keyword">if</span> ~isempty(TemporaryVariable),
0175             RFRed(TrialIndex)=CurrentCodes(TemporaryVariable(1))-5000;
0176              RFGreen(TrialIndex)=CurrentCodes(TemporaryVariable(1)+1)-5300;
0177              RFBlue(TrialIndex)=CurrentCodes(TemporaryVariable(1)+2)-5600;
0178         <span class="keyword">end</span>
0179 
0180         <span class="keyword">if</span> ~isempty(is_rfoff)
0181             RFOffTime(TrialIndex)=CurrentTimes(is_rfoff(1));
0182         <span class="comment">%else fprintf('%s\n','Weird in OneJump: RFOff without RFOn');</span>
0183 <span class="comment">%         else keyboard;</span>
0184         <span class="keyword">end</span>
0185         
0186         TemporaryVariable=find(abs(CurrentTimes-RFOnTime(TrialIndex))&lt;5 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0187 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RFOnTime(TrialIndex)&amp;CurrentCodes&lt;6350&amp;CurrentCodes&gt;=5650);</span>
0188         <span class="keyword">if</span> ~isempty(TemporaryVariable), RFx(TrialIndex)=(CurrentCodes(TemporaryVariable(1))-6000)/10;<span class="keyword">end</span>
0189 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RFOnTime(TrialIndex)&amp;CurrentCodes&gt;6250&amp;CurrentCodes&lt;=6750);</span>
0190         <span class="keyword">if</span> ~isempty(TemporaryVariable), RFy(TrialIndex)=(CurrentCodes(TemporaryVariable(2))-6500)/10;<span class="keyword">end</span>
0191 
0192 <span class="comment">%         if RFy(TrialIndex)&lt;0, keyboard;end</span>
0193           
0194     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf) loop</span>
0195     
0196 
0197         
0198     <span class="keyword">if</span> ~isempty(is_rf2), RF2OnTime(TrialIndex)=CurrentTimes(is_rf2(1));
0199         
0200         FindResult=find(CurrentCodes&gt;=10000 &amp; abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;60);
0201           <span class="keyword">if</span> length(FindResult)&gt;=1
0202               RF2Checksize(TrialIndex)=nanmin(CurrentCodes(FindResult)-10000); <span class="keyword">end</span>  
0203         
0204         TemporaryVariable=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=5255&amp;CurrentCodes&gt;=5000);
0205         <span class="keyword">if</span> ~isempty(TemporaryVariable),
0206             RF2Red(TrialIndex)=CurrentCodes(TemporaryVariable(1))-5000;
0207             RF2Green(TrialIndex)=CurrentCodes(TemporaryVariable(1)+1)-5300;
0208             RF2Blue(TrialIndex)=CurrentCodes(TemporaryVariable(1)+2)-5600;
0209         <span class="keyword">end</span>
0210         TemporaryVariable=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0211 
0212 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RF2OnTime(TrialIndex)&amp;CurrentCodes&lt;6250&amp;CurrentCodes&gt;=5750);</span>
0213         <span class="keyword">if</span> ~isempty(TemporaryVariable), RF2x(TrialIndex)=(CurrentCodes(TemporaryVariable(1))-6000)/10;<span class="keyword">end</span>
0214 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RF2OnTime(TrialIndex)&amp;CurrentCodes&gt;6250&amp;CurrentCodes&lt;=6750);</span>
0215         <span class="keyword">if</span> ~isempty(TemporaryVariable), RF2y(TrialIndex)=(CurrentCodes(TemporaryVariable(2))-6500)/10;<span class="keyword">end</span>
0216 TempVarRed=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=5000&amp;CurrentCodes&gt;=5299);
0217         <span class="comment">%         if ~isempty(TempVarRed), RF2Red(TrialIndex)=(CurrentCodes(TempVarRed(1))-5000);end</span>
0218         <span class="comment">%          TempVarGreen=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=5300&amp;CurrentCodes&gt;=5599);</span>
0219         <span class="comment">%          if ~isempty(TempVarGreen), RF2Green(TrialIndex)=(CurrentCodes(TempVarGreen(1))-5300);end</span>
0220         <span class="comment">%           TempVarBlue=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=5600&amp;CurrentCodes&gt;=5899);</span>
0221         <span class="comment">%           if ~isempty(TempVarBlue), RF2Blue(TrialIndex)=(CurrentCodes(TempVarBlue(1))-5600);end</span>
0222         <span class="comment">%         if RF2Red(TrialIndex)~=0&amp;RF2Green(TrialIndex)==0, RF2isRed(TrialIndex)=1; end</span>
0223         <span class="comment">%         if RF2Red(TrialIndex)==0&amp;RF2Green(TrialIndex)~=0, RF2isGreen(TrialIndex)=1; end</span>
0224         TemporaryVariable=find(abs(CurrentTimes-RF2OnTime(TrialIndex))&lt;100 &amp; CurrentCodes&lt;=5855&amp;CurrentCodes&gt;=5000);
0225         <span class="comment">% keyboard;</span>
0226          
0227 <span class="comment">%         if ~isempty(TemporaryVariable),</span>
0228 <span class="comment">%             RF2Red(TrialIndex)=CurrentCodes(TemporaryVariable(1))-5000;</span>
0229 <span class="comment">%             RF2Green(TrialIndex)=CurrentCodes(TemporaryVariable(1)+1)-5300;</span>
0230 <span class="comment">%             RF2Blue(TrialIndex)=CurrentCodes(TemporaryVariable(1)+2)-5600;</span>
0231 <span class="comment">%         end</span>
0232         
0233         <span class="keyword">if</span> ~isempty(is_rf2off)
0234             RF2OffTime(TrialIndex)=CurrentTimes(is_rf2off(1));
0235            
0236             <span class="comment">%else fprintf('%s\n','Weird in OneJump: RFOff without RFOn');</span>
0237             <span class="comment">%         else keyboard;</span>
0238         <span class="keyword">end</span>
0239     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf2) loop</span>
0240         
0241     <span class="keyword">if</span> ~isempty(is_jump), JumpOnTime=CurrentTimes(is_jump(1));
0242         FindResult=find(CurrentCodes&gt;=10000 &amp; abs(CurrentTimes-JumpOnTime)&lt;60);
0243         
0244         TemporaryVariable=find(abs(CurrentTimes-JumpOnTime)&lt;100 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0245 
0246 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RF2OnTime(TrialIndex)&amp;CurrentCodes&lt;6250&amp;CurrentCodes&gt;=5750);</span>
0247         <span class="keyword">if</span> ~isempty(TemporaryVariable), Jumpx(TrialIndex)=(CurrentCodes(TemporaryVariable(1))-6000)/10;<span class="keyword">end</span>
0248 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RF2OnTime(TrialIndex)&amp;CurrentCodes&gt;6250&amp;CurrentCodes&lt;=6750);</span>
0249         <span class="keyword">if</span> ~isempty(TemporaryVariable), Jumpy(TrialIndex)=(CurrentCodes(TemporaryVariable(2))-6500)/10;<span class="keyword">end</span>
0250     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf2) loop</span>
0251     
0252     
0253 <span class="comment">%If gap, set bad trials</span>
0254 
0255 <span class="keyword">if</span> ~isempty(is_gap), 
0256     GapTime(TrialIndex)=CurrentTimes(is_gap(1));
0257     <span class="keyword">if</span> GoodTrial(TrialIndex)~=1 &amp; AbortTrial(TrialIndex)~=1 &amp; FixationBreak(TrialIndex)~=1
0258         <span class="keyword">if</span> ~isempty(is_error), BadTrial(TrialIndex)=1;     
0259         <span class="keyword">else</span> BadTrial(TrialIndex)=2;
0260         <span class="keyword">end</span>
0261     <span class="keyword">end</span>
0262 <span class="keyword">end</span>   <span class="comment">%gap has to have occurred for a true bad trial</span>
0263 
0264 <span class="comment">%array number filling</span>
0265 
0266 <a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>;    <span class="comment">%ArrayBak needs to be initialized at onset. Make sure</span>
0267 
0268 <span class="comment">%SaccadeAnalysis</span>
0269 
0270         <span class="keyword">if</span> WTF(TrialIndex)&gt;=100,  GoodTrial(TrialIndex)=NaN; BadTrial(TrialIndex)=NaN; <span class="keyword">end</span>
0271         
0272         <span class="keyword">if</span>(GoodTrial(TrialIndex)==1 || BadTrial(TrialIndex)==1)
0273             
0274        SacStruct=<a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>(Trials((TrialIndex)),1003,SacOpts.ISICut,SacOpts.MinLat,0,0,SacOpts.Threshold);
0275        Sacs{TrialIndex}=SacStruct;
0276   
0277        <span class="comment">%Now search and allocate</span>
0278        
0279 <span class="comment">% if ~isnan(SacStruct(1).latency) %i hope this is enough</span>
0280             
0281     SacAmp=[SacStruct.amplitude];
0282     SacLat=[SacStruct.latency];
0283     SacDur=[SacStruct.duration];
0284     StartX=[SacStruct.startx];
0285     EndX=[SacStruct.endx];
0286     StartY=[SacStruct.starty];
0287     EndY=[SacStruct.endy];
0288     EndAtRF2=sqrt( (EndX-RF2x(TrialIndex)).^2 + (EndY-RF2y(TrialIndex)).^2 );
0289     EndAtJump=sqrt( (EndX-Jumpx(TrialIndex)).^2 + (EndY-Jumpy(TrialIndex)).^2 );
0290     EndAtRF=sqrt( (EndX-RFx(TrialIndex)).^2 + (EndY-RFy(TrialIndex)).^2 );    
0291     EndAtFP=sqrt( (EndX-FPx(TrialIndex)).^2 + (EndY-FPy(TrialIndex)).^2 ); 
0292     StartFromFP=sqrt( (StartX-FPx(TrialIndex)).^2 + (StartY-FPy(TrialIndex)).^2 );
0293     StartFromRF2=sqrt( (StartX-RF2x(TrialIndex)).^2 + (StartY-RF2y(TrialIndex)).^2 );
0294     StartFromRF=sqrt( (StartX-RFx(TrialIndex)).^2 + (StartY-RFy(TrialIndex)).^2 );    
0295     
0296     
0297     RefTime=GapTime(TrialIndex)-FPOnTime(TrialIndex)-100;
0298     
0299 find_the_sac=find(SacLat&gt;= RefTime &amp; SacLat&lt;=(RefTime+500)); <span class="comment">%this gives me 400 ms after true gap on begins</span>
0300     
0301     HowManySacs(TrialIndex)=length(find_the_sac);
0302     <span class="keyword">if</span> HowManySacs(TrialIndex)&gt;0
0303     SaccadicLatency(TrialIndex)=SacStruct(find_the_sac(1)).latency;
0304     SacEndX1(TrialIndex)=EndX(1);
0305     SacEndY1(TrialIndex)=EndY(1);
0306     <span class="keyword">end</span>
0307     
0308 find_the_sac=find(SacLat&gt;= RefTime &amp; SacLat&lt;=(RefTime+500) &amp; EndAtRF2&lt;5.5); <span class="comment">%this gives me 400 ms after true gap on begins</span>
0309 HowManyFinSacs(TrialIndex)=length(find_the_sac);
0310 <span class="keyword">if</span> HowManyFinSacs(TrialIndex)&gt;0
0311 FinWhichSac(TrialIndex)=find_the_sac(1);
0312 FinWhichSacLat(TrialIndex)=SacLat(find_the_sac(1));
0313 Curv(TrialIndex)=SacStruct(find_the_sac(1)).curvature(1);
0314 <span class="keyword">end</span>
0315 
0316 find_the_sac=find(SacLat&gt;= RefTime &amp; SacLat&lt;=(RefTime+500) &amp; EndAtRF&lt;5.0); <span class="comment">%this gives me 400 ms after true gap on begins</span>
0317 HowManyDSacs(TrialIndex)=length(find_the_sac);
0318 <span class="keyword">if</span> HowManyDSacs(TrialIndex)&gt;0
0319 FirstDSac(TrialIndex)=find_the_sac(1);  <span class="comment">%note that firstdsac can be 1, and also finwhichsac will be 1, if rf2 and rf are really close to each other</span>
0320 FirstDSacLat(TrialIndex)=SacLat(find_the_sac(1));
0321 <span class="keyword">end</span>   
0322     
0323     <span class="comment">%Key Saccade !!!</span>
0324     
0325     find_the_sac=find(StartFromFP&lt;3 &amp; EndAtRF2 &lt; 3 &amp; SacLat&gt;= (GapTime(TrialIndex)-FPOnTime(TrialIndex)));
0326     find_the_sac=find(StartFromFP&lt;4 &amp; (EndAtRF2 &lt; 5|EndAtJump&lt;5) &amp; SacLat&gt;= (GapTime(TrialIndex)-FPOnTime(TrialIndex))-50); <span class="comment">%used to be 2,2 for fp and rf2</span>
0327     <span class="keyword">if</span> length(find_the_sac)&gt;1, fprintf(<span class="string">'%d\t%s\n'</span>,TrialIndex,<span class="string">'More than one fp_to_rf2 !!'</span>);<span class="keyword">end</span>
0328 
0329 <span class="comment">%     if GoodTrial(TrialIndex)==1 &amp; length(find_the_sac)==0, fprintf('change parameters   %d\n',TrialIndex);end</span>
0330 <span class="comment">%     if(TrialIndex==27), keyboard;end</span>
0331     
0332 <span class="comment">%     if GoodTrial(TrialIndex)==1, keyboard;end</span>
0333     
0334     <a href="../../XeX/UtilityFunctions/assorted/CreateTempSac.html" class="code" title="">CreateTempSac</a>;
0335     <span class="keyword">if</span> isempty(find_the_sac), FPToRF2(TrialIndex)=0;<span class="keyword">end</span>
0336     FPToRF2Sac(TrialIndex)=TempSac; clear TempSac;
0337     
0338     <span class="comment">%Others</span>
0339     
0340 <span class="comment">%     find_the_sac=find(StartFromRF2 &lt; 4);</span>
0341 <span class="comment">% %     if length(find_the_sac)&gt;1, fprintf('%d\t%s\n',TrialIndex,'More than one start from rf2 !!');end</span>
0342 <span class="comment">%     CreateTempSac;</span>
0343 <span class="comment">%     FromRF2Sac(TrialIndex)=TempSac; clear TempSac;</span>
0344 <span class="comment">%</span>
0345 <span class="comment">%     find_the_sac=find(StartFromFP &lt; 4);</span>
0346 <span class="comment">% %     if length(find_the_sac)&gt;1, fprintf('%d\t%s\n',TrialIndex,'More than one start from fp !!');end</span>
0347 <span class="comment">%     CreateTempSac;</span>
0348 <span class="comment">%     FromFPSac(TrialIndex)=TempSac; clear TempSac;</span>
0349 <span class="comment">%</span>
0350 
0351     find_the_sac=find(EndAtRF2 &lt; 3 &amp; SacLat&gt;= (GapTime(TrialIndex)-FPOnTime(TrialIndex))-50);
0352 
0353 <span class="comment">%     find_the_sac=find(EndAtRF2 &lt; 4);</span>
0354 <span class="comment">% %     if length(find_the_sac)&gt;1, fprintf('%d\t%s\n',TrialIndex,'More than one ends at rf2 !!');end</span>
0355     <a href="../../XeX/UtilityFunctions/assorted/CreateTempSac.html" class="code" title="">CreateTempSac</a>;
0356     <span class="keyword">if</span> isempty(find_the_sac), ToRF2(TrialIndex)=0;<span class="keyword">else</span> ToRF2(TrialIndex)=1;<span class="keyword">end</span>
0357     ToRF2Sac(TrialIndex)=TempSac; clear TempSac;
0358     
0359 <span class="comment">%</span>
0360     find_the_sac=find(EndAtRF &lt; 6 &amp; StartFromFP&lt;3 &amp; EndAtRF2&gt;3&amp; SacLat&gt;= (GapTime(TrialIndex)-FPOnTime(TrialIndex))-50);
0361 <span class="comment">% %     if length(find_the_sac)&gt;1, fprintf('%d\t%s\n',TrialIndex,'More than one ends at rf !!');end</span>
0362     <a href="../../XeX/UtilityFunctions/assorted/CreateTempSac.html" class="code" title="">CreateTempSac</a>;
0363     <span class="keyword">if</span> isempty(find_the_sac), ToRF(TrialIndex)=0;<span class="keyword">else</span> ToRF(TrialIndex)=1;<span class="keyword">end</span>
0364     ToRFSac(TrialIndex)=TempSac; clear TempSac;
0365 <span class="comment">%</span>
0366 <span class="comment">%     find_the_sac=find(EndAtFP &lt; 4);</span>
0367 <span class="comment">% %     if length(find_the_sac)&gt;1, fprintf('%d\t%s\n',TrialIndex,'More than one ends at fp !!');end</span>
0368 <span class="comment">%     CreateTempSac;</span>
0369 <span class="comment">%     ToFPSac(TrialIndex)=TempSac; clear TempSac;</span>
0370 <span class="comment">%</span>
0371 <span class="comment">%     find_the_sac=find(SacLat&gt;=(GapTime(TrialIndex)-FPOnTime(TrialIndex)-60) &amp; SacLat &lt;= (RewardTime(TrialIndex)-FPOnTime(TrialIndex)) &amp; SacAmp &gt;=5 );</span>
0372 <span class="comment">%     CreateTempSac;</span>
0373 <span class="comment">%     FirstGapSac(TrialIndex)=TempSac; clear TempSac;</span>
0374 <span class="comment">%     JNumSacs(TrialIndex)=length(find_the_sac);</span>
0375 <span class="comment">%</span>
0376         <span class="keyword">end</span>  <span class="comment">% ending  if(GoodTrial==1 || BadTrial==1)</span>
0377     
0378 <span class="comment">%     if TrialIndex==13, keyboard;end</span>
0379     
0380 <span class="comment">%     if JNumSacs(TrialIndex)~=1, keyboard;end</span>
0381 <span class="comment">%     end  % ending the sacccade analysis loop</span>
0382     
0383 
0384 <span class="keyword">end</span>   <span class="comment">%ending main loop</span>
0385 
0386 <span class="comment">% keyboard;</span>
0387 RFDur=RFOffTime-RFOnTime;
0388 RFDur(isnan(RFx)&amp;isnan(RFy))=-1; <span class="comment">% hack for no stimulus trials</span>
0389 
0390 RFGood=(RFOffTime-RFOnTime)&lt;40 &amp; (RFOffTime-RFOnTime)&gt;20;  <span class="comment">%rf has to be brief, 40 because of 60 Hz refresh rate, and only for flash stimuli. No use for continuous stimuli.</span>
0391 
0392 
0393 
0394 TrueGood=nan*GoodTrial;
0395 RFEccentricity=sqrt( (RFx-FPx).^2 + (RFy-FPy).^2 );
0396 JumpSacTime=[FPToRF2Sac.latency];
0397 SacRelRFOn=RFOnTime-FPOnTime-JumpSacTime;    <span class="comment">%RFOnTime relative to Saccade Onset</span>
0398 SacRelRFOff=RFOffTime-FPOnTime-JumpSacTime;  <span class="comment">%RFOffTime relative to Saccade Onset</span>
0399 
0400 RFLat=(RFOnTime-GapTime);
0401 <span class="comment">%dRFLat=DiscretizeMe(RFLat,[50 100 150]);</span>
0402 dRFLat=<a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>(RFLat,[50 100 150 200]);
0403 fprintf(<span class="string">'%s\t'</span>,<span class="string">'dRFing with'</span>); fprintf(<span class="string">'%d '</span>,<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(dRFLat)); fprintf(<span class="string">'%s\n'</span>,<span class="string">''</span>);
0404 RFSacLat=-1*SacRelRFOn;
0405 SacLat=JumpSacTime-GapTime+FPOnTime;
0406 FinWhichSacLat=FinWhichSacLat-GapTime+FPOnTime;
0407 FirstDSacLat=FirstDSacLat-GapTime+FPOnTime;
0408 RFSacLat_Cor=dRFLat+RFSacLat;
0409 
0410 JWhichSac=[FPToRF2Sac.whichsac];
0411 
0412 <span class="comment">%alf stuff for top down</span>
0413 RF2dist_toRF=sqrt( (RF2x-RFx).^2 + (RF2y-RFy).^2 );
0414 
0415 <span class="comment">% KLUGE FOR KDE CALC</span>
0416 
0417 <span class="comment">% RFSacLat_Cor(BadTrial==1)=10000;</span>
0418 <span class="comment">% SacLat(BadTrial==1)=10000;</span>
0419 
0420 SacAlignTime1=JumpSacTime+FPOnTime;  <span class="comment">%this is crucial !! Or weird bugs</span>
0421 
0422 <span class="comment">% cell kluging</span>
0423 
0424 <span class="keyword">if</span> ~exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>) | (exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>)  &amp; isempty(strfind(klugestring,<span class="string">'z050808'</span>)))
0425  TrueGood(BadTrial==1&amp;PhotoBad~=1)=0;  <span class="comment">%removed RFGood==1, for continuous stimuli. Use in filter, if needed.</span>
0426  TrueGood(GoodTrial==1&amp;PhotoBad~=1)=1;
0427 <span class="keyword">else</span> 
0428 fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Kluging for cell      '</span> klugestring]);
0429 <span class="keyword">end</span>
0430 
0431 RGood(GoodTrial==1&amp;PhotoBad~=1&amp;RFDur&lt;=50)=1;
0432 RGood(BadTrial==1&amp;PhotoBad~=1&amp;RFDur&lt;=50)=0;
0433 
0434  
0435  <span class="comment">%Now printing out details of analysis</span>
0436 
0437  summaryString=[sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0438  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(Trials)) <span class="string">'  trials'</span>])];
0439  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(PhotoBad==1))) <span class="string">' PhotoBad Trials'</span>])];
0440  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(RFPhotoBad==1))) <span class="string">'RFPhotoBad Trials'</span>])];
0441  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(FixationBreak==1))) <span class="string">' Fixation Breaks '</span>])];
0442  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(GoodTrial==1))) <span class="string">'  Good Trials'</span>])];
0443  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(BadTrial==1))),<span class="string">'  Bad Trials'</span>])];
0444  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(GoodTrial==1&amp;FPToRF2==0))),<span class="string">'  Good Trials with Bad Saccades'</span>])];
0445   <span class="keyword">if</span> length(find(GoodTrial==1|BadTrial==1))&gt;0
0446  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(100*(length(find(GoodTrial==1)))/length(find(GoodTrial==1|BadTrial==1)),<span class="string">'%3.2f'</span>) <span class="string">'  % correct'</span>])];
0447   summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str( 100*length(find(isnan(RFx) &amp; GoodTrial==1))/length(find(GoodTrial==1)),<span class="string">'%3.2f'</span>) <span class="string">' % good no-stimulus trials'</span>])]; 
0448  <span class="keyword">else</span> summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'No good or bad trials'</span>)];
0449  <span class="keyword">end</span>
0450  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(WTF&gt;=100))) <span class="string">'   Weird Trials. WTF &gt; 100'</span>])];
0451  <span class="keyword">if</span> length(find(~isnan(RFOnTime)))&gt;0
0452  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str( 100*length(find(~isnan(RFOffTime) &amp; RFOffTime-RFOnTime &lt;=100))/length(find(RFOnTime(~isnan(RFOnTime)))),<span class="string">'%3.2f'</span>) <span class="string">' % flashes'</span>])]; 
0453  <span class="keyword">else</span> summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'No RFs'</span>)];<span class="keyword">end</span>
0454  
0455 
0456  
0457  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0458  
0459  RFmat=[RFx;RFy]';
0460 RFmat=RFmat(~isnan(RFmat(:,1)),:);
0461 
0462 <span class="keyword">if</span> ~isempty(RFmat)
0463     
0464  RFmat=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(RFmat);
0465  
0466  <span class="keyword">if</span> exist(<span class="string">'UseAx'</span>,<span class="string">'var'</span>)&amp;&amp;UseAx~=0, axes(UseAx); 
0467     plot(RFx,RFy,<span class="string">'bo'</span>);
0468  <span class="keyword">end</span>
0469 
0470     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'RFx     RFy'</span>)];
0471     <span class="keyword">for</span> ii=1:size(RFmat,1)
0472         summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([RFmat(ii,1) RFmat(ii,2)],<span class="string">'%6.2f'</span>))];
0473     <span class="keyword">end</span>
0474 <span class="keyword">else</span>
0475     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'No RF'</span>)];
0476 <span class="keyword">end</span>
0477 
0478  RF2mat=[RF2x;RF2y]';
0479 RF2mat=RF2mat(~isnan(RF2x),:);
0480 
0481 <span class="keyword">if</span> ~isempty(RF2mat)
0482 RF2mat=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(RF2mat);
0483 <span class="keyword">if</span> length(RF2mat)&lt;10
0484     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'RF2x     RF2y'</span>)];
0485     <span class="keyword">for</span> ii=1:size(RF2mat,1)
0486         summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([RF2mat(ii,1) RF2mat(ii,2)],<span class="string">'%6.2f'</span>))];
0487     <span class="keyword">end</span>
0488     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'********'</span>)];
0489 <span class="keyword">end</span>
0490 <span class="keyword">else</span> summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'No RF2'</span>)];
0491 <span class="keyword">end</span>
0492 
0493 FPmat=[FPx(GoodTrial==1);FPy(GoodTrial==1)]'; <span class="comment">%the GoodTrial==1 prevents 0 from showing up</span>
0494 FPmat=FPmat(~isnan(FPmat(:,1)),:);
0495 
0496 <span class="keyword">if</span> ~isempty(FPmat)
0497 <span class="keyword">if</span> size(FPmat,1)&gt;1
0498     FPmat=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(FPmat);
0499 <span class="keyword">end</span>
0500 <span class="keyword">if</span> length(FPmat)&lt;10
0501     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'FPx     FPy'</span>)];
0502     <span class="keyword">for</span> ii=1:size(FPmat,1)
0503         summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([FPmat(ii,1) FPmat(ii,2)],<span class="string">'%6.2f'</span>))];
0504     <span class="keyword">end</span>
0505     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'********'</span>)];
0506 <span class="keyword">end</span>
0507 <span class="keyword">else</span> summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'No FPs'</span>)];
0508 <span class="keyword">end</span>
0509 
0510 <span class="comment">% summaryString=[summaryString sprintf('%s\n','---------------------ANALYSIS NOTES---------------------------')];</span>
0511 <span class="comment">% summaryString=[summaryString sprintf('%s\n','1. Look at RFLat histogram, and dRFLat dischistogram')];</span>
0512 <span class="comment">% summaryString=[summaryString sprintf('%s\n','2. Look at SacLat Histogram for GoodTrial==1&amp;PhotoBad~=1&amp;~isnan(RFx)')];</span>
0513 <span class="comment">% summaryString=[summaryString sprintf('%s\n','Eventually incorporate into command set ')];</span>
0514 summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'USE RFPHOTOBAD'</span>)];
0515 <span class="comment">% summaryString=[summaryString sprintf('%s\n','---------------------ANALYSIS NOTES---------------------------')];</span>
0516 
0517 <span class="comment">%packing variables into CurrentVariables</span>
0518 
0519 fprintf(<span class="string">'%s\n'</span>,summaryString);
0520 <a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>;
0521 
0522 <span class="comment">%how many gap times</span>
0523 <span class="comment">%mean control latency</span>
0524 <span class="comment">%percentage of good trials</span>
0525 <span class="comment">%percentage of bad trials to rf2</span>
0526 <span class="comment">%percentage of first saccade to target</span>
0527 <span class="comment">%percentage of first saccade to rf2</span>
0528 <span class="comment">%mean curvature index of first saccade to rf2</span>
0529 <span class="comment">%mean saccade amplitude error (better than endpoint, as calibration can</span>
0530 <span class="comment">%easily drift)</span></pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>