<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of LineMotion</title>
  <meta name="keywords" content="LineMotion">
  <meta name="description" content="This function analyzes files from the line motion paradigm">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html XeX --><!-- menu.html PreProcFunctions -->
<h1>LineMotion
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This function analyzes files from the line motion paradigm</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function CurrentVariables=LineMotion(Trials,klugestring,UseAx,SacOpts) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">    This function analyzes files from the line motion paradigm
    See also:
    CurrentVariables=LineMotion(Trials,klugestring,UseAx,SacOpts)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>	This script evaluates what variables are present in the calling</li><li><a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>	This function takes in a vector (or a matrix) , and returns unique values (or rows). NaNs (and rows with NaNs) are removed.</li><li><a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>	this function takes in a vector and discretizes it, by finding the closest</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../XeX/OutsideXex/Preproc.html" class="code" title="function CurrentVariables=Preproc(Trials,CurrentAnalysisFile,SacCorrectCode)">Preproc</a>	function CurrentVariables=Preproc(Trials,SaccadeOptions,ProcType)</li><li><a href="../../XeX/OutsideXex/SampleSession.html" class="code" title="">SampleSession</a>	</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function CurrentVariables=LineMotion(Trials,klugestring,UseAx,SacOpts)</a>
0002 
0003 <span class="comment">%    This function analyzes files from the line motion paradigm</span>
0004 <span class="comment">%    See also:</span>
0005 <span class="comment">%    CurrentVariables=LineMotion(Trials,klugestring,UseAx,SacOpts)</span>
0006 
0007 <span class="comment">% to analyze linemotion</span>
0008 
0009 <span class="comment">%Initializing Variables</span>
0010 
0011 ArrayNumber=nan*ones(1,length(Trials));
0012 GoodTrial=ArrayNumber;
0013 BadTrial=ArrayNumber;
0014 PhotoBad=ArrayNumber;
0015 TrialNumber=1:length(Trials);
0016 RFTrialIndex=ArrayNumber;
0017 
0018 AbortTrial=ArrayNumber;
0019 FixationBreak=ArrayNumber;
0020 
0021 RewardTime=ArrayNumber;
0022 ErrorTime=ArrayNumber;
0023 
0024 FPTime=ArrayNumber;
0025 RFOnTime=ArrayNumber;
0026 RFOffTime=ArrayNumber;
0027 RFDur=ArrayNumber;
0028 RFx=ArrayNumber;
0029 RFy=ArrayNumber;
0030 RFPat=ArrayNumber;
0031 RFChecksize=ArrayNumber;
0032 
0033 RF2x=ArrayNumber;
0034 RF2y=ArrayNumber;
0035 RF2OnTime=ArrayNumber;
0036 RF2OffTime=ArrayNumber;
0037 RF2Dur=ArrayNumber;
0038 RF2OnTime=ArrayNumber;
0039 RF2Checksize=ArrayNumber;
0040 RF2Pat=ArrayNumber;
0041 
0042 RFLen=ArrayNumber;
0043 
0044 FPx=RFx;
0045 FPy=RFy;
0046 
0047 ArrayBak=[];
0048 
0049 MyVariableList={<span class="string">'ArrayNumber'</span>,<span class="string">'GoodTrial'</span>,<span class="string">'BadTrial'</span>,<span class="string">'PhotoBad'</span>,<span class="string">'TrialNumber'</span>,<span class="string">'AbortTrial'</span>,<span class="string">'FixationBreak'</span>,<span class="string">'RewardTime'</span>,<span class="string">'ErrorTime'</span>,<span class="string">'FPTime'</span>,<span class="string">'RFOnTime'</span>,<span class="string">'RFOffTime'</span>,<span class="string">'RFDur'</span>,<span class="string">'RFx'</span>,<span class="string">'RFy'</span>,<span class="string">'RFPat'</span>,<span class="string">'RF2x'</span>,<span class="string">'RF2y'</span>,<span class="string">'RF2OnTime'</span>,<span class="string">'RF2Dur'</span>,<span class="string">'ISI'</span>,<span class="string">'dISI'</span>,<span class="string">'RF2RFD'</span>,<span class="string">'RFLen'</span>};
0050 MyResponseVariableList={<span class="string">'GoodTrial'</span>};
0051 
0052  <span class="keyword">for</span> TrialIndex=1:length(Trials)
0053     
0054     CurrentEvents=Trials(TrialIndex).Events;
0055     CurrentCodes=double([CurrentEvents.Code]);
0056     CurrentTimes=double([CurrentEvents.Time]);
0057     
0058     RFTrialIndex(TrialIndex)=TrialIndex;
0059     
0060     is_reward=find(CurrentCodes==1012);
0061     is_error=find(CurrentCodes==1013);
0062     is_fp=find(CurrentCodes==1003);
0063     is_rf=find(CurrentCodes==1007);
0064     is_rfoff=find(CurrentCodes==1010);
0065     is_photobad=find(CurrentCodes==1092);
0066     is_abort=find(CurrentCodes==1090);
0067     is_fixationbreak=find(CurrentCodes==1091);
0068     is_rf2=find(CurrentCodes==1047);
0069     is_rf2off=find(CurrentCodes==1040);
0070     
0071     <span class="keyword">if</span> ~isempty(is_reward), GoodTrial(TrialIndex)=1;
0072     RewardTime(TrialIndex)=CurrentTimes(is_reward(1));
0073     <span class="keyword">elseif</span> ~isempty(is_error),
0074     ErrorTime(TrialIndex)=CurrentTimes(is_error(1));
0075     <span class="keyword">end</span>
0076 
0077     <span class="keyword">if</span> ~isempty(is_fp), FPTime(TrialIndex)=CurrentTimes(is_fp(1));<span class="keyword">end</span>
0078                    
0079     <span class="keyword">if</span> ~isempty(is_fp)
0080         EarlyDrops=find(CurrentCodes&gt;=10700 &amp; abs(CurrentTimes-FPTime(TrialIndex))&lt;=30);  <span class="comment">%within 30ms of FP On</span>
0081         <span class="keyword">if</span> length(EarlyDrops)&gt;=4
0082         FPx(TrialIndex)=(CurrentCodes(EarlyDrops(3))-11000)/10;
0083         FPy(TrialIndex)=(CurrentCodes(EarlyDrops(4))-11000)/10;
0084         <span class="keyword">end</span>
0085         
0086         <span class="keyword">if</span> length(EarlyDrops)&gt;=7 RFLen(TrialIndex)=(CurrentCodes(EarlyDrops(7)))-11000; <span class="keyword">end</span>
0087         
0088     <span class="keyword">end</span>
0089     
0090     
0091     
0092     <span class="keyword">if</span> ~isempty(is_photobad), PhotoBad(TrialIndex)=1;<span class="keyword">end</span>
0093     <span class="keyword">if</span> ~isempty(is_abort) AbortTrial(TrialIndex)=1;<span class="keyword">end</span>
0094     <span class="keyword">if</span> ~isempty(is_fixationbreak) FixationBreak(TrialIndex)=1;<span class="keyword">end</span>
0095     
0096     <span class="keyword">if</span> ~isempty(is_rf), RFOnTime(TrialIndex)=CurrentTimes(is_rf(1));
0097      
0098         FindResult=find(CurrentCodes&gt;=10000 &amp; (CurrentTimes-RFOnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RFOnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn</span>
0099           <span class="keyword">if</span> length(FindResult)&gt;=1
0100               RFChecksize(TrialIndex)=nanmin(CurrentCodes(FindResult)-10000); 
0101           <span class="keyword">end</span>  
0102 
0103         FindResult=find(CurrentCodes&gt;=7000 &amp; (CurrentTimes-RFOnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RFOnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn</span>
0104         <span class="keyword">if</span> length(FindResult)&gt;=1
0105             RFPat(TrialIndex)=CurrentCodes(FindResult(1))-7000;
0106         <span class="keyword">end</span>
0107 
0108         FindResult=find(CurrentCodes&gt;=5700 &amp; CurrentCodes&lt;=6800 &amp; (CurrentTimes-RFOnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RFOnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn, max abs coords of 300</span>
0109         <span class="keyword">if</span> length(FindResult)&gt;=2
0110             RFx(TrialIndex)=(CurrentCodes(FindResult(1))-6000)/10;
0111             RFy(TrialIndex)=(CurrentCodes(FindResult(2))-6500)/10;
0112         <span class="keyword">end</span>     
0113         
0114     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf) loop</span>
0115 
0116    <span class="keyword">if</span> ~isempty(is_rfoff)
0117     RFOffTime(TrialIndex)=CurrentTimes(is_rfoff(1));
0118    <span class="keyword">end</span>
0119     
0120  <span class="keyword">if</span> ~isempty(is_rf2), RF2OnTime(TrialIndex)=CurrentTimes(is_rf2(1));
0121         
0122       FindResult=find(CurrentCodes&gt;=5700 &amp; CurrentCodes&lt;=6800 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn, max abs coords of 300</span>
0123         <span class="keyword">if</span> length(FindResult)&gt;=2
0124             RF2x(TrialIndex)=(CurrentCodes(FindResult(1))-6000)/10;
0125             RF2y(TrialIndex)=(CurrentCodes(FindResult(2))-6500)/10;
0126         <span class="keyword">end</span>     
0127    
0128          FindResult=find(CurrentCodes&gt;=10000 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn</span>
0129           <span class="keyword">if</span> length(FindResult)&gt;=1
0130               RF2Checksize(TrialIndex)=nanmin(CurrentCodes(FindResult)-10000); 
0131           <span class="keyword">end</span>  
0132 
0133         FindResult=find(CurrentCodes&gt;=7000 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&gt;=0 &amp; (CurrentTimes-RF2OnTime(TrialIndex))&lt;=50 ); <span class="comment">%Within 50 ms of RFOn</span>
0134         <span class="keyword">if</span> length(FindResult)&gt;=1
0135             RF2Pat(TrialIndex)=CurrentCodes(FindResult(1))-7000;
0136         <span class="keyword">end</span>
0137  
0138         <span class="keyword">if</span> ~isempty(is_rf2off), RF2OffTime(TrialIndex)=CurrentTimes(is_rf2off(1));<span class="keyword">end</span>
0139  
0140  <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf2) loop</span>
0141 
0142 
0143 <span class="keyword">if</span> ~isempty(is_rf) &amp; GoodTrial(TrialIndex)~=1 &amp; AbortTrial(TrialIndex)~=1 &amp; FixationBreak(TrialIndex)~=1
0144     <span class="keyword">if</span> ~isempty(is_error), BadTrial(TrialIndex)=1; 
0145     <span class="keyword">else</span> BadTrial(TrialIndex)=2;<span class="keyword">end</span>
0146 <span class="keyword">end</span>
0147     
0148     <span class="comment">%a little fiddling to take care of oCurrentCodesasions where rex doenst drop an arrya code. details.</span>
0149     <span class="comment">% Verify this IMP</span>
0150     
0151     TemporaryArrayNumber=find(CurrentCodes&gt;=2000&amp;CurrentCodes&lt;=2060);
0152     <span class="keyword">if</span> ~isempty(TemporaryArrayNumber)
0153         <span class="keyword">if</span> length(TemporaryArrayNumber)==1 ArrayNumber(TrialIndex)=CurrentCodes(TemporaryArrayNumber)-2000; ArrayBak=[];
0154         <span class="keyword">elseif</span> length(TemporaryArrayNumber)==2 ArrayNumber(TrialIndex)=CurrentCodes(TemporaryArrayNumber(1))-2000; ArrayBak=CurrentCodes(TemporaryArrayNumber(2))-2000;
0155         <span class="keyword">else</span> ArrayNumber(TrialIndex)=-1; ArrayBak=[];
0156         <span class="keyword">end</span>
0157     <span class="keyword">elseif</span> ~isempty(ArrayBak) ArrayNumber(TrialIndex)=ArrayBak; ArrayBak=[];
0158     <span class="keyword">end</span>
0159     
0160  <span class="keyword">end</span>
0161 
0162 ISI=RF2OnTime-RFOnTime;
0163 dISI=<a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>(ISI,-1000:100:100);
0164 dISI(isnan(RF2x))=0;
0165 FPOnTime=FPTime;
0166  RF2RFD=sqrt( (RF2x-RFx).^2 + (RF2y-RFy).^2 );
0167  RFDur=(RFOffTime-RFOnTime);
0168  RF2Dur=(RF2OffTime-RF2OnTime);
0169  dRFDur=<a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>(RFDur, 50:100:1000);
0170  dRF2Dur=<a href="../../XeX/UtilityFunctions/gettingAndsettingParameters/DiscretizeMe.html" class="code" title="function DiscretizedX=DiscretizeMe(X,CenterVector)">DiscretizeMe</a>(RF2Dur, 50:100:1000);
0171  
0172  <span class="comment">%Now printing out details of analysis</span>
0173   summaryString=[ sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0174  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(Trials)) <span class="string">'  trials'</span>])];
0175  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(GoodTrial==1))) <span class="string">'  Good Trials'</span>])];
0176  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(BadTrial==1))),<span class="string">'  Bad Trials'</span>])];
0177  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(100*(length(find(GoodTrial==1)))/length(find(GoodTrial==1|BadTrial==1)),<span class="string">'%3.2f'</span>) <span class="string">'  % correct'</span>])];
0178  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0179 
0180  RFmat=[RFx;RFy]';
0181 RFmat=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(RFmat);
0182 <span class="keyword">if</span> length(RFmat)&lt;10
0183     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'RFx     RFy'</span>)];
0184     <span class="keyword">for</span> ii=1:size(RFmat,1)
0185         summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([RFmat(ii,1) RFmat(ii,2)],<span class="string">'%6.2f'</span>))];
0186     <span class="keyword">end</span>
0187 <span class="keyword">end</span>
0188 
0189  RF2mat=[RF2x;RF2y]';
0190 RF2mat=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(RF2mat);
0191 <span class="keyword">if</span> length(RF2mat)&lt;10
0192     summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'RF2x     RF2y'</span>)];
0193     <span class="keyword">for</span> ii=1:size(RF2mat,1)
0194         summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([RF2mat(ii,1) RF2mat(ii,2)],<span class="string">'%6.2f'</span>))];
0195     <span class="keyword">end</span>
0196 <span class="keyword">end</span>
0197 
0198 summaryString=[summaryString sprintf(<span class="string">'%s\t'</span>,<span class="string">'Unique ISIS are'</span>)];
0199 summaryString=[summaryString sprintf(<span class="string">'%d\t'</span>,<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(dISI))];
0200 summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">''</span>)];
0201 
0202  fprintf(<span class="string">'%s\n'</span>,summaryString);
0203   <a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>;</pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>