<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PostSac</title>
  <meta name="keywords" content="PostSac">
  <meta name="description" content="This function analyzes trials from the old jumping eye-position task">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html XeX --><!-- menu.html PreProcFunctions -->
<h1>PostSac
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This function analyzes trials from the old jumping eye-position task</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function CurrentVariables=PostSac(Trials,klugestring,UseAx,SacOpts) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">    This function analyzes trials from the old jumping eye-position task
    CurrentVariables=PostSac(Trials,klugestring,UseAx,SacOpts)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>	A little scriplet that does</li><li><a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>	function SacStruct=MakeSacStruct(WhichType)</li><li><a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>	This script evaluates what variables are present in the calling</li><li><a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>	The main XeX saccade parser</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function CurrentVariables=PostSac(Trials,klugestring,UseAx,SacOpts)</a>
0002 
0003 <span class="comment">%    This function analyzes trials from the old jumping eye-position task</span>
0004 <span class="comment">%    CurrentVariables=PostSac(Trials,klugestring,UseAx,SacOpts)</span>
0005 
0006 <span class="comment">%Initializing Variables</span>
0007 
0008 ArrayNumber=nan*ones(1,length(Trials));
0009 GoodTrial=ArrayNumber;
0010 BadTrial=ArrayNumber;
0011 PhotoBad=ArrayNumber;
0012 TrialNumber=1:length(Trials);
0013 
0014 AbortTrial=ArrayNumber;
0015 FixationBreak=ArrayNumber;
0016 
0017 RewardTime=ArrayNumber;
0018 ErrorTime=ArrayNumber;
0019 
0020 RFTrialIndex=ArrayNumber;
0021 
0022 FPx=ArrayNumber;
0023 FPy=FPx;
0024 FPang=FPx;
0025 FPOnTime=FPy;
0026 ToFPDelay=FPx;
0027 
0028 ToFPSac=<a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>(2);
0029 
0030 ArrayBak=[];   <span class="comment">%for ArrayFiddleCodeBit</span>
0031 
0032 MyVariableList={<span class="string">'ArrayNumber'</span>,<span class="string">'GoodTrial'</span>,<span class="string">'BadTrial'</span>,<span class="string">'PhotoBad'</span>,<span class="string">'TrialNumber'</span>,<span class="string">'AbortTrial'</span>,<span class="string">'FixationBreak'</span>,<span class="string">'RewardTime'</span>,<span class="string">'ErrorTime'</span>,<span class="string">'RFTrialIndex'</span>,<span class="string">'FPx'</span>,<span class="string">'FPy'</span>,<span class="string">'FPang'</span>,<span class="string">'FPOnTime'</span>,<span class="keyword">...</span>
0033     <span class="string">'TrueGood'</span>,<span class="string">'JumpSacTime'</span>,<span class="string">'ToFPAngle'</span>,<span class="string">'ToFPDelay'</span>};
0034 MyResponseVariableList={<span class="string">'GoodTrial'</span>};
0035 
0036 <span class="keyword">for</span> TrialIndex=1:length(Trials)
0037     
0038     <span class="keyword">if</span> rem(TrialIndex,500)==0, fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Finished   '</span> num2str(TrialIndex) <span class="string">'  Trials'</span>]);<span class="keyword">end</span>
0039     
0040     CurrentEvents=Trials(TrialIndex).Events;
0041     CurrentCodes=double([CurrentEvents.Code]);
0042     CurrentTimes=double([CurrentEvents.Time]);
0043     
0044     RFTrialIndex(TrialIndex)=TrialIndex;
0045     
0046     is_reward=find(CurrentCodes==1012);
0047     is_error=find(CurrentCodes==1013);
0048     is_fp=find(CurrentCodes==1003);
0049     is_photobad=find(CurrentCodes==1092);
0050     is_abort=find(CurrentCodes==1090);
0051     is_fixationbreak=find(CurrentCodes==1091);
0052 
0053     
0054     <span class="keyword">if</span> ~isempty(is_fp)
0055         EarlyDrops=find(CurrentCodes&gt;=10700);
0056         <span class="keyword">if</span> length(EarlyDrops)&gt;=4
0057         FPx(TrialIndex)=(CurrentCodes(EarlyDrops(3))-11000)/10;
0058         FPy(TrialIndex)=(CurrentCodes(EarlyDrops(4))-11000)/10;
0059         <span class="keyword">end</span>
0060     <span class="keyword">end</span>
0061     
0062     <span class="keyword">if</span> ~isempty(is_reward), GoodTrial(TrialIndex)=1;
0063             RewTimeVar=CurrentTimes(find(CurrentCodes==1012));
0064     RewardTime(TrialIndex)=RewTimeVar(1);    
0065     <span class="keyword">elseif</span> ~isempty(is_error),
0066     ErrorTime(TrialIndex)=CurrentTimes(find(CurrentCodes==1013));
0067     <span class="keyword">end</span>
0068 
0069     <span class="keyword">if</span> ~isempty(is_fp), FPOnTime(TrialIndex)=CurrentTimes(is_fp(1));<span class="keyword">end</span>
0070     <span class="keyword">if</span> ~isempty(is_photobad), PhotoBad(TrialIndex)=1;<span class="keyword">end</span>
0071     <span class="keyword">if</span> ~isempty(is_abort) AbortTrial(TrialIndex)=1;<span class="keyword">end</span>
0072     <span class="keyword">if</span> ~isempty(is_fixationbreak) FixationBreak(TrialIndex)=1;<span class="keyword">end</span>
0073     
0074 <span class="comment">%array number filling</span>
0075 
0076 <a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>;    <span class="comment">%ArrayBak needs to be initialized at onset. Make sure</span>
0077 
0078 <span class="comment">%SaccadeAnalysis</span>
0079 
0080        SacStruct=<a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>(Trials((TrialIndex)),0,SacOpts.ISICut,SacOpts.MinLat,0,0,SacOpts.Threshold);
0081 <span class="comment">%        [SacStruct.angle]=deal([atan2([SacStruct.endy]-[SacStruct.starty],[SacStruct.endx]-[SacStruct.startx])]);</span>
0082   
0083        <span class="comment">%Now search and allocate</span>
0084        
0085     SacAmp=[SacStruct.amplitude];
0086     SacLat=[SacStruct.latency];
0087     SacDur=[SacStruct.duration];
0088     StartX=[SacStruct.startx];
0089     EndX=[SacStruct.endx];
0090     StartY=[SacStruct.starty];
0091     EndY=[SacStruct.endy];
0092     EndAtFP=sqrt( (EndX-FPx(TrialIndex)).^2 + (EndY-FPy(TrialIndex)).^2 ); 
0093         
0094     <span class="comment">%Key Saccade !!!</span>
0095     
0096     find_the_sac=find(EndAtFP &lt; 4 &amp; SacLat&lt;= FPOnTime(TrialIndex)); 
0097         <span class="keyword">if</span> ~isempty(find_the_sac)
0098         TempSac=SacStruct(find_the_sac(1));
0099         TempSac.whichsac=find_the_sac(1);
0100         TempSac.angle=atan2(EndY(find_the_sac(1))-StartY(find_the_sac(1)),EndX(find_the_sac(1))-StartX(find_the_sac(1)));
0101         <span class="keyword">if</span> TempSac.whichsac==1, ToFPDelay(TrialIndex)=TempSac.latency; <span class="keyword">else</span> ToFPDelay(TrialIndex)=SacStruct(find_the_sac(1)).latency-(SacStruct(find_the_sac(1)-1).latency+SacStruct(find_the_sac(1)-1).duration);<span class="keyword">end</span>
0102 
0103     <span class="keyword">else</span>
0104        TempSac=<a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>(2);
0105         <span class="keyword">end</span>
0106      
0107     ToFPSac(TrialIndex)=TempSac; clear TempSac;
0108     JNumSacs(TrialIndex)=length(find_the_sac);
0109    
0110     
0111 <span class="keyword">end</span>   <span class="comment">%ending main loop</span>
0112 
0113 
0114 TrueGood=nan*GoodTrial;
0115 JumpSacTime=[ToFPSac.latency];
0116 ToFPAngle=[ToFPSac.angle];
0117 ToFPAngle(ToFPAngle&lt;0)=2*pi+ToFPAngle(ToFPAngle&lt;0);
0118 FPang=atan2(FPy,FPx);
0119 FPang(FPang&lt;0)=2*pi+FPang(FPang&lt;0);
0120 
0121 SacAlignTime1=JumpSacTime;  <span class="comment">%this is crucial !!</span>
0122 
0123 
0124 <span class="comment">% cell kluging</span>
0125 
0126 <span class="keyword">if</span> ~exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>) | (exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>)  &amp; isempty(strfind(klugestring,<span class="string">'z050808'</span>)))
0127  TrueGood(BadTrial==1&amp;PhotoBad~=1)=0;  <span class="comment">%removed RFGood==1, for continuous stimuli. Use in filter, if needed.</span>
0128  TrueGood(GoodTrial==1&amp;PhotoBad~=1)=1;
0129 <span class="keyword">else</span>
0130 fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Kluging for cell      '</span> klugestring]);
0131 <span class="keyword">end</span>
0132 
0133 <span class="comment">%packing variables into CurrentVariables</span>
0134 
0135 
0136  
0137  <span class="comment">%Now printing out details of analysis</span>
0138 
0139  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0140  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(Trials)) <span class="string">'  trials'</span>])];
0141  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(PhotoBad==1))) <span class="string">' PhotoBad Trials'</span>])];
0142  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(GoodTrial==1))) <span class="string">'  Good Trials'</span>])];
0143  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(BadTrial==1))),<span class="string">'  Bad Trials'</span>])];
0144  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(100*(length(find(GoodTrial==1)))/length(find(GoodTrial==1|BadTrial==1)),<span class="string">'%3.2f'</span>) <span class="string">'  % correct'</span>])];
0145  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0146 
0147 
0148 fprintf(<span class="string">'%s\n'</span>,summaryString);
0149 <a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>;</pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>