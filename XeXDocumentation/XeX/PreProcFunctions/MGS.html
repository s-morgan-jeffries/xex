<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of MGS</title>
  <meta name="keywords" content="MGS">
  <meta name="description" content="This function analyzes files from the MGS paradigm">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html XeX --><!-- menu.html PreProcFunctions -->
<h1>MGS
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This function analyzes files from the MGS paradigm</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function CurrentVariables=MGS(Trials,klugestring,UseAx,SacOpts) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">    This function analyzes files from the MGS paradigm
    CurrentVariables=MGS(Trials,klugestring,UseAx,SacOpts)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>	A little scriplet that does</li><li><a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>	function SacStruct=MakeSacStruct(WhichType)</li><li><a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>	This script evaluates what variables are present in the calling</li><li><a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>	This function takes in a vector (or a matrix) , and returns unique values (or rows). NaNs (and rows with NaNs) are removed.</li><li><a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>	The main XeX saccade parser</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function CurrentVariables=MGS(Trials,klugestring,UseAx,SacOpts)</a>
0002 
0003 <span class="comment">%    This function analyzes files from the MGS paradigm</span>
0004 <span class="comment">%    CurrentVariables=MGS(Trials,klugestring,UseAx,SacOpts)</span>
0005 
0006 <span class="comment">%Initializing Variables</span>
0007 
0008 ArrayNumber=nan*ones(1,length(Trials));
0009 GoodTrial=ArrayNumber;
0010 BadTrial=ArrayNumber;
0011 PhotoBad=ArrayNumber;
0012 TrialNumber=1:length(Trials);
0013 
0014 AbortTrial=ArrayNumber;
0015 FixationBreak=ArrayNumber;
0016 
0017 RewardTime=ArrayNumber;
0018 ErrorTime=ArrayNumber;
0019 RFOnTime=ArrayNumber;
0020 RFOffTime=ArrayNumber;
0021 RFx=ArrayNumber;
0022 RFy=ArrayNumber;
0023 RFTrialIndex=ArrayNumber;
0024 
0025 FPx=RFx;
0026 FPy=RFy;
0027 FPOnTime=RFy;
0028 
0029 
0030 GapTime=ArrayNumber;
0031 
0032 JNumSacs=ArrayNumber; <span class="comment">%number of saccades between gap on and reward</span>
0033 
0034 <span class="comment">% FPToRFSac=MakeSacStruct(1);</span>
0035 <span class="comment">% FirstGapSac=FPToRFSac;</span>
0036 <span class="comment">% FromRFSac=FPToRFSac;</span>
0037 
0038 ArrayBak=[];   <span class="comment">%for ArrayFiddleCodeBit</span>
0039 
0040 MyVariableList={<span class="string">'ArrayNumber'</span>,<span class="string">'GoodTrial'</span>,<span class="string">'BadTrial'</span>,<span class="string">'PhotoBad'</span>,<span class="string">'TrialNumber'</span>,<span class="string">'AbortTrial'</span>,<span class="string">'FixationBreak'</span>,<span class="string">'RewardTime'</span>,<span class="string">'ErrorTime'</span>,<span class="string">'RFOnTime'</span>,<span class="string">'RFOffTime'</span>,<span class="string">'RFx'</span>,<span class="string">'RFy'</span>,<span class="string">'RFAng'</span>,<span class="string">'RFPat'</span>,<span class="string">'RFTrialIndex'</span>,<span class="string">'FPx'</span>,<span class="string">'FPy'</span>,<span class="string">'FPOnTime'</span>,<span class="string">'GapTime'</span><span class="keyword">...</span>
0041     <span class="string">'JNumSacs'</span>,<span class="string">'TrueGood'</span>,<span class="string">'JumpSacTime'</span>,<span class="string">'SacAlignTime1'</span>,<span class="string">'SacAlignTime2'</span>,<span class="string">'SacRelRFOn'</span>};
0042 MyResponseVariableList={<span class="string">'TrueGood'</span>};
0043 
0044 <span class="keyword">for</span> TrialIndex=1:length(Trials)
0045     
0046     <span class="keyword">if</span> rem(TrialIndex,500)==0, fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Finished   '</span> num2str(TrialIndex) <span class="string">'  Trials'</span>]);<span class="keyword">end</span>
0047     
0048     CurrentEvents=Trials(TrialIndex).Events;
0049     CurrentCodes=double([CurrentEvents.Code]);
0050     CurrentTimes=double([CurrentEvents.Time]);
0051     
0052     RFTrialIndex(TrialIndex)=TrialIndex;
0053     
0054     is_reward=find(CurrentCodes==1012);
0055     is_error=find(CurrentCodes==1013);
0056     is_fp=find(CurrentCodes==1003);
0057     is_rf=find(CurrentCodes==1007);
0058     is_rfoff=find(CurrentCodes==1010);
0059     is_photobad=find(CurrentCodes==1092);
0060     is_abort=find(CurrentCodes==1090);
0061     is_fixationbreak=find(CurrentCodes==1091);
0062     is_gap=find(CurrentCodes==1004);
0063     
0064             
0065     <span class="keyword">if</span> ~isempty(is_fp)
0066         EarlyDrops=find(CurrentCodes&gt;=10700);
0067         <span class="keyword">if</span> length(EarlyDrops)&gt;=4
0068         FPx(TrialIndex)=(CurrentCodes(EarlyDrops(3))-11000)/10;
0069         FPy(TrialIndex)=(CurrentCodes(EarlyDrops(4))-11000)/10;
0070         <span class="keyword">end</span>
0071     <span class="keyword">end</span>
0072     
0073     <span class="keyword">if</span> ~isempty(is_reward), GoodTrial(TrialIndex)=1;
0074             RewTimeVar=CurrentTimes(find(CurrentCodes==1012));
0075     RewardTime(TrialIndex)=RewTimeVar(1);    
0076     <span class="keyword">elseif</span> ~isempty(is_error),
0077     ErrorTime(TrialIndex)=CurrentTimes(find(CurrentCodes==1013));
0078     <span class="keyword">end</span>
0079 
0080     <span class="keyword">if</span> ~isempty(is_fp), FPOnTime(TrialIndex)=CurrentTimes(is_fp(1));<span class="keyword">end</span>
0081     <span class="keyword">if</span> ~isempty(is_photobad), PhotoBad(TrialIndex)=1;<span class="keyword">end</span>
0082     <span class="keyword">if</span> ~isempty(is_abort) AbortTrial(TrialIndex)=1;<span class="keyword">end</span>
0083     <span class="keyword">if</span> ~isempty(is_fixationbreak) FixationBreak(TrialIndex)=1;<span class="keyword">end</span>
0084     
0085     <span class="comment">%RF Properties</span>
0086     
0087     <span class="keyword">if</span> ~isempty(is_rf), RFOnTime(TrialIndex)=CurrentTimes(is_rf(1));
0088         
0089         <span class="keyword">if</span> ~isempty(is_rfoff)
0090             RFOffTime(TrialIndex)=CurrentTimes(is_rfoff(1));
0091         <span class="comment">%else fprintf('%s\n','Weird in OneJump: RFOff without RFOn');</span>
0092 <span class="comment">%         else keyboard;</span>
0093         <span class="keyword">end</span>
0094 
0095         TemporaryVariable=find((CurrentTimes-RFOnTime(TrialIndex))&lt;70 &amp; (CurrentTimes-RFOnTime(TrialIndex))&gt;=0 &amp; CurrentCodes&lt;=6850&amp;CurrentCodes&gt;=5650);
0096 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RFOnTime(TrialIndex)&amp;CurrentCodes&lt;6250&amp;CurrentCodes&gt;=5750);</span>
0097         <span class="keyword">if</span> length(TemporaryVariable&gt;=2), RFx(TrialIndex)=(CurrentCodes(TemporaryVariable(1))-6000)/10; <span class="comment">%end</span>
0098 <span class="comment">%         TemporaryVariable=find(CurrentTimes&gt;=RFOnTime(TrialIndex)&amp;CurrentCodes&gt;6250&amp;CurrentCodes&lt;=6750);</span>
0099 <span class="comment">%         if ~isempty(TemporaryVariable),</span>
0100             RFy(TrialIndex)=(CurrentCodes(TemporaryVariable(2))-6500)/10;
0101      <span class="keyword">end</span>
0102 
0103     <span class="keyword">end</span> <span class="comment">%ending the if ~isempty(is_rf) loop</span>
0104     
0105 <span class="comment">%If gap, set bad trials</span>
0106 
0107 <span class="keyword">if</span> ~isempty(is_gap), 
0108     GapTime(TrialIndex)=CurrentTimes(is_gap(1));
0109     <span class="keyword">if</span> GoodTrial(TrialIndex)~=1 &amp; AbortTrial(TrialIndex)~=1 &amp; FixationBreak(TrialIndex)~=1
0110         <span class="keyword">if</span> ~isempty(is_error), BadTrial(TrialIndex)=1;     
0111         <span class="keyword">else</span> BadTrial(TrialIndex)=2;
0112         <span class="keyword">end</span>
0113     <span class="keyword">end</span>
0114 <span class="keyword">end</span>   <span class="comment">%gap has to have occurred for a true bad trial</span>
0115 
0116 <span class="comment">%array number filling</span>
0117 
0118 <a href="../../XeX/UtilityFunctions/assorted/ArrayFiddleCodeBit.html" class="code" title="">ArrayFiddleCodeBit</a>;    <span class="comment">%ArrayBak needs to be initialized at onset. Make sure</span>
0119 
0120 <span class="comment">%SaccadeAnalysis</span>
0121         
0122        SacStruct=<a href="../../XeX/UtilityFunctions/main/SacFind.html" class="code" title="function [Saccades,FiltX,FiltY]=SacFind(Trial,CorrectCode,MinISI,MinLat,PlotVar,FigNum,Threshold,Ax)">SacFind</a>(Trials((TrialIndex)),1003,SacOpts.ISICut,SacOpts.MinLat,0,0,SacOpts.Threshold);
0123   
0124        <span class="comment">%Now search and allocate</span>
0125        
0126 <span class="comment">% if ~isnan(SacStruct(1).latency) %i hope this is enough</span>
0127             
0128     SacAmp=[SacStruct.amplitude];
0129     SacLat=[SacStruct.latency];
0130     SacDur=[SacStruct.duration];
0131     StartX=[SacStruct.startx];
0132     EndX=[SacStruct.endx];
0133     StartY=[SacStruct.starty];
0134     EndY=[SacStruct.endy];
0135     EndAtRF=sqrt( (EndX-RFx(TrialIndex)).^2 + (EndY-RFy(TrialIndex)).^2 );    
0136     StartFromFP=sqrt( (StartX-FPx(TrialIndex)).^2 + (StartY-FPy(TrialIndex)).^2 );
0137     StartFromRF=sqrt( (StartX-RFx(TrialIndex)).^2 + (StartY-RFy(TrialIndex)).^2 );
0138    
0139 
0140     <span class="comment">%Key Saccade !!!</span>
0141     
0142     find_the_sac=find(StartFromFP&lt;3 &amp; EndAtRF &lt; 7 &amp; SacLat&gt;= (GapTime(TrialIndex)-FPOnTime(TrialIndex)));
0143     <span class="keyword">if</span> length(find_the_sac)&gt;1, fprintf(<span class="string">'%d\t%s\n'</span>,TrialIndex,<span class="string">'More than one fp_to_rf !!'</span>);<span class="keyword">end</span>
0144    <span class="keyword">if</span> GoodTrial(TrialIndex)==1 &amp; isempty(find_the_sac), fprintf(<span class="string">'%s\n'</span>,<span class="string">'More strangeness in RF code drops'</span>);<span class="keyword">end</span>
0145     
0146     <span class="keyword">if</span> ~isempty(find_the_sac)
0147         TempSac=SacStruct(find_the_sac(1));
0148         TempSac.rfdistance=EndAtRF(find_the_sac(1));
0149         TempSac.gaplatency=SacLat(find_the_sac(1))-GapTime(TrialIndex);
0150         TempSac.whichsac=find_the_sac(1);
0151         TempSac.angle=atan2(EndY(find_the_sac(1))-StartY(find_the_sac(1)),EndX(find_the_sac(1))-StartX(find_the_sac(1)));
0152     <span class="keyword">else</span>
0153        TempSac=<a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>(1);
0154        TempSac.rfdistance=nan; TempSac.gaplatency=nan; TempSac.whichsac=NaN; TempSac.angle=nan;
0155     <span class="keyword">end</span>
0156 
0157     FPToRFSac(TrialIndex)=TempSac; clear TempSac;
0158     
0159     find_the_sac=find(SacLat&gt;=(GapTime(TrialIndex)-FPOnTime(TrialIndex)));
0160 
0161         <span class="keyword">if</span> ~isempty(find_the_sac)
0162         TempSac=SacStruct(find_the_sac(1));
0163         TempSac.rfdistance=EndAtRF(find_the_sac(1));
0164         TempSac.gaplatency=SacLat(find_the_sac(1))-GapTime(TrialIndex);
0165         TempSac.whichsac=find_the_sac(1);
0166         TempSac.angle=atan2(EndY(find_the_sac(1))-StartY(find_the_sac(1)),EndX(find_the_sac(1))-StartX(find_the_sac(1)));
0167     <span class="keyword">else</span>
0168        TempSac=<a href="../../XeX/UtilityFunctions/assorted/MakeSacStruct.html" class="code" title="function SacStruct=MakeSacStruct(WhichType)">MakeSacStruct</a>(1);
0169        TempSac.rfdistance=nan; TempSac.gaplatency=nan; TempSac.whichsac=NaN; TempSac.angle=nan;
0170         <span class="keyword">end</span>
0171 
0172         FirstGapSac(TrialIndex)=TempSac; clear TempSac;
0173     JNumSacs(TrialIndex)=length(find_the_sac);
0174 
0175 <span class="comment">%</span>
0176 <span class="comment">%     find_the_sac=find(SacLat&gt;=(GapTime(TrialIndex)-FPOnTime(TrialIndex))&amp;StartFromRF&lt;3);</span>
0177 <span class="comment">%         if ~isempty(find_the_sac)</span>
0178 <span class="comment">%         TempSac=SacStruct(find_the_sac(1));</span>
0179 <span class="comment">%         TempSac.rfdistance=EndAtRF(find_the_sac(1));</span>
0180 <span class="comment">%         TempSac.gaplatency=SacLat(find_the_sac(1))-GapTime(TrialIndex);</span>
0181 <span class="comment">%         TempSac.whichsac=find_the_sac(1);</span>
0182 <span class="comment">%         TempSac.angle=atan2(EndY(find_the_sac(1))-StartY(find_the_sac(1)),EndX(find_the_sac(1))-StartX(find_the_sac(1)));</span>
0183 <span class="comment">%     else</span>
0184 <span class="comment">%        TempSac=MakeSacStruct(2);</span>
0185 <span class="comment">%     end</span>
0186 <span class="comment">%         FromRFSac(TrialIndex)=TempSac; clear TempSac;</span>
0187 
0188 
0189 <span class="keyword">end</span>   <span class="comment">%ending main loop</span>
0190 
0191 RFGood=(RFOffTime-RFOnTime)&lt;100 &amp; (RFOffTime-RFOnTime)&gt;20;  <span class="comment">%rf has to be brief, 40 because of 60 Hz refresh rate, and only for flash stimuli. No use for continuous stimuli.</span>
0192 TrueGood=nan*GoodTrial;
0193 RFEccentricity=sqrt( (RFx-FPx).^2 + (RFy-FPy).^2 );
0194 JumpSacTime=[FPToRFSac.latency];
0195 SacRelRFOn=RFOnTime-FPOnTime-JumpSacTime;    <span class="comment">%RFOnTime relative to Saccade Onset</span>
0196 
0197 SacAlignTime1=JumpSacTime+FPOnTime;  <span class="comment">%this is crucial !! Or weird bugs</span>
0198 <span class="comment">% SacAlignTime2=[FromRFSac.latency]+FPOnTime;</span>
0199  RFAng=atan2(RFy,RFx);
0200  RFAng(RFAng&lt;0)=2*pi+RFAng(RFAng&lt;0);
0201  UnRFAng=<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>(RFAng);
0202 
0203 <span class="comment">% cell kluging</span>
0204 
0205 <span class="keyword">if</span> ~exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>) | (exist(<span class="string">'klugestring'</span>,<span class="string">'var'</span>)  &amp; isempty(strfind(klugestring,<span class="string">'z050808'</span>)))
0206  TrueGood(BadTrial==1&amp;PhotoBad~=1)=0;  <span class="comment">%removed RFGood==1, for continuous stimuli. Use in filter, if needed.</span>
0207  TrueGood(GoodTrial==1&amp;PhotoBad~=1)=1;
0208 <span class="keyword">else</span>
0209 fprintf(<span class="string">'%s\n'</span>,[<span class="string">'Kluging for cell      '</span> klugestring]);
0210 <span class="keyword">end</span>
0211 
0212 
0213  <span class="comment">%Now printing out details of analysis</span>
0214 
0215  summaryString=[ sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0216  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(Trials)) <span class="string">'  trials'</span>])];
0217  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(PhotoBad==1))) <span class="string">' PhotoBad Trials'</span>])];
0218  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(GoodTrial==1))) <span class="string">'  Good Trials'</span>])];
0219  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(length(find(BadTrial==1))),<span class="string">'  Bad Trials'</span>])];
0220  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,[num2str(100*(length(find(GoodTrial==1)))/length(find(GoodTrial==1|BadTrial==1)),<span class="string">'%3.2f'</span>) <span class="string">'  % correct'</span>])];
0221  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,num2str([<a href="../../XeX/UtilityFunctions/assorted/un.html" class="code" title="function X1=un(X)">un</a>([RFx RFy])]))];
0222  summaryString=[summaryString sprintf(<span class="string">'%s\n'</span>,<span class="string">'******************************************************************'</span>)];
0223  RFmat=[RFx;RFy]';
0224  RFmat=RFmat(~isnan(RFmat(:,1)),:);
0225  RFmat=unique(RFmat,<span class="string">'rows'</span>);
0226  
0227  <span class="keyword">if</span> exist(<span class="string">'UseAx'</span>,<span class="string">'var'</span>)&amp;&amp;UseAx~=0, axes(UseAx); 
0228     plot(RFx,RFy,<span class="string">'bo'</span>);
0229 <span class="keyword">end</span>
0230 
0231  <span class="comment">%packing variables into CurrentVariables</span>
0232 
0233 fprintf(<span class="string">'%s\n'</span>,summaryString);
0234 <a href="../../XeX/UtilityFunctions/assorted/attachvars.html" class="code" title="">attachvars</a>;</pre></div>
<hr><address>Generated on Wed 13-Dec-2006 00:06:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>